{"version":3,"file":"index-DDu8Ccrb.js","sources":["../../src/core/Physics.js","../../src/core/ParticleSystem.js","../../src/core/AudioEngine.js","../../src/components/Player.js","../../src/components/Gate.js","../../src/components/StarGeometry.js","../../src/main.js"],"sourcesContent":["/**\n * Physics Engine for Ocean Adventure\n *\n * Implements collision detection and underwater physics simulation\n * including buoyancy, drag, and environmental forces.\n */\n\nimport * as THREE from 'three'\n\n/**\n * Collision system supporting AABB and sphere-based collision detection\n */\nexport class CollisionSystem {\n  constructor() {\n    this.colliders = []\n    this.staticColliders = []\n  }\n\n  /**\n   * Add a collider to the system\n   * @param {Object} collider - Collider object with geometry and position\n   * @param {boolean} isStatic - Whether the collider is static (doesn't move)\n   */\n  addCollider(collider, isStatic = false) {\n    const list = isStatic ? this.staticColliders : this.colliders\n    list.push(collider)\n  }\n\n  /**\n   * Remove a collider from the system\n   * @param {Object} collider - Collider to remove\n   */\n  removeCollider(collider) {\n    let index = this.colliders.indexOf(collider)\n    if (index !== -1) {\n      this.colliders.splice(index, 1)\n      return\n    }\n\n    index = this.staticColliders.indexOf(collider)\n    if (index !== -1) {\n      this.staticColliders.splice(index, 1)\n    }\n  }\n\n  /**\n   * Check for collisions between two objects\n   * @param {Object} objectA - First object with position and geometry\n   * @param {Object} objectB - Second object with position and geometry\n   * @returns {boolean} Whether objects are colliding\n   */\n  checkCollision(objectA, objectB) {\n    // Sphere-sphere collision detection\n    if (\n      objectA.collisionType === 'sphere' &&\n      objectB.collisionType === 'sphere'\n    ) {\n      return this.checkSphereCollision(objectA, objectB)\n    }\n\n    // AABB-AABB collision detection\n    if (objectA.collisionType === 'box' && objectB.collisionType === 'box') {\n      return this.checkAABBCollision(objectA, objectB)\n    }\n\n    // Sphere-AABB collision detection\n    if (\n      (objectA.collisionType === 'sphere' && objectB.collisionType === 'box') ||\n      (objectA.collisionType === 'box' && objectB.collisionType === 'sphere')\n    ) {\n      return this.checkSphereAABBCollision(objectA, objectB)\n    }\n\n    return false\n  }\n\n  /**\n   * Check sphere-sphere collision\n   * @param {Object} sphereA - First sphere\n   * @param {Object} sphereB - Second sphere\n   * @returns {boolean} Whether spheres are colliding\n   */\n  checkSphereCollision(sphereA, sphereB) {\n    const distance = sphereA.position.distanceTo(sphereB.position)\n    const radiusSum = sphereA.radius + sphereB.radius\n    return distance <= radiusSum\n  }\n\n  /**\n   * Check AABB-AABB collision\n   * @param {Object} boxA - First box\n   * @param {Object} boxB - Second box\n   * @returns {boolean} Whether boxes are colliding\n   */\n  checkAABBCollision(boxA, boxB) {\n    const minA = boxA.position\n      .clone()\n      .sub(boxA.size.clone().multiplyScalar(0.5))\n    const maxA = boxA.position\n      .clone()\n      .add(boxA.size.clone().multiplyScalar(0.5))\n    const minB = boxB.position\n      .clone()\n      .sub(boxB.size.clone().multiplyScalar(0.5))\n    const maxB = boxB.position\n      .clone()\n      .add(boxB.size.clone().multiplyScalar(0.5))\n\n    return (\n      minA.x <= maxB.x &&\n      maxA.x >= minB.x &&\n      minA.y <= maxB.y &&\n      maxA.y >= minB.y &&\n      minA.z <= maxB.z &&\n      maxA.z >= minB.z\n    )\n  }\n\n  /**\n   * Check sphere-AABB collision\n   * @param {Object} objectA - First object (sphere or box)\n   * @param {Object} objectB - Second object (sphere or box)\n   * @returns {boolean} Whether objects are colliding\n   */\n  checkSphereAABBCollision(objectA, objectB) {\n    const sphere = objectA.collisionType === 'sphere' ? objectA : objectB\n    const box = objectA.collisionType === 'box' ? objectA : objectB\n\n    const boxMin = box.position\n      .clone()\n      .sub(box.size.clone().multiplyScalar(0.5))\n    const boxMax = box.position\n      .clone()\n      .add(box.size.clone().multiplyScalar(0.5))\n\n    // Find closest point on box to sphere center\n    const closestPoint = new THREE.Vector3(\n      Math.max(boxMin.x, Math.min(sphere.position.x, boxMax.x)),\n      Math.max(boxMin.y, Math.min(sphere.position.y, boxMax.y)),\n      Math.max(boxMin.z, Math.min(sphere.position.z, boxMax.z))\n    )\n\n    const distance = sphere.position.distanceTo(closestPoint)\n    return distance <= sphere.radius\n  }\n\n  /**\n   * Check all collisions for a given object\n   * @param {Object} object - Object to check collisions for\n   * @returns {Array} Array of colliding objects\n   */\n  checkCollisions(object) {\n    const collisions = []\n\n    // Check against dynamic colliders\n    for (const collider of this.colliders) {\n      if (collider !== object && this.checkCollision(object, collider)) {\n        collisions.push(collider)\n      }\n    }\n\n    // Check against static colliders\n    for (const collider of this.staticColliders) {\n      if (this.checkCollision(object, collider)) {\n        collisions.push(collider)\n      }\n    }\n\n    return collisions\n  }\n}\n\n/**\n * Underwater physics simulation\n */\nexport class UnderwaterPhysics {\n  constructor() {\n    this.buoyancyForce = 2.0 // Further reduced buoyancy force (was 4.0)\n    this.dragCoefficient = 0.95 // Water resistance (0-1, lower = more drag)\n    this.currentDirection = new THREE.Vector3(0.1, 0, 0.05) // Gentle underwater current\n    this.currentStrength = 0.02\n  }\n\n  /**\n   * Apply buoyancy force to an object\n   * @param {Object} body - Physics body with velocity and position\n   * @param {number} deltaTime - Time since last frame\n   */\n  applyBuoyancy(body, deltaTime) {\n    const buoyancy = new THREE.Vector3(0, this.buoyancyForce * deltaTime, 0)\n    body.velocity.add(buoyancy)\n  }\n\n  /**\n   * Apply drag force to an object\n   * @param {Object} body - Physics body with velocity\n   */\n  applyDrag(body) {\n    body.velocity.multiplyScalar(this.dragCoefficient)\n  }\n\n  /**\n   * Apply underwater current to an object\n   * @param {Object} body - Physics body with velocity\n   * @param {number} currentStrength - Strength multiplier for current effect\n   * @param {number} deltaTime - Time since last frame\n   */\n  applyCurrent(body, currentStrength = 1.0, deltaTime) {\n    const currentForce = this.currentDirection\n      .clone()\n      .multiplyScalar(this.currentStrength * currentStrength * deltaTime)\n    body.velocity.add(currentForce)\n  }\n\n  /**\n   * Apply all underwater physics effects\n   * @param {Object} body - Physics body\n   * @param {number} deltaTime - Time since last frame\n   */\n  applyUnderwaterEffects(body, deltaTime) {\n    this.applyBuoyancy(body, deltaTime)\n    this.applyDrag(body)\n    this.applyCurrent(body, 1.0, deltaTime)\n  }\n}\n\n/**\n * Main Physics Engine\n */\nexport class PhysicsEngine {\n  constructor() {\n    this.gravity = new THREE.Vector3(0, -9.8, 0)\n    this.waterDensity = 1000 // kg/mÂ³\n    this.collisionSystem = new CollisionSystem()\n    this.underwaterPhysics = new UnderwaterPhysics()\n    this.rigidBodies = []\n    this.isUnderwater = true // For now, everything is underwater\n  }\n\n  /**\n   * Add a rigid body to the physics simulation\n   * @param {Object} body - Physics body to add\n   */\n  addRigidBody(body) {\n    this.rigidBodies.push(body)\n\n    // Add to collision system if it has collision properties\n    if (body.collisionType) {\n      this.collisionSystem.addCollider(body, body.isStatic)\n    }\n  }\n\n  /**\n   * Remove a rigid body from the physics simulation\n   * @param {Object} body - Physics body to remove\n   */\n  removeRigidBody(body) {\n    const index = this.rigidBodies.indexOf(body)\n    if (index !== -1) {\n      this.rigidBodies.splice(index, 1)\n      this.collisionSystem.removeCollider(body)\n    }\n  }\n\n  /**\n   * Update all physics bodies\n   * @param {number} deltaTime - Time since last frame\n   */\n  update(deltaTime) {\n    for (const body of this.rigidBodies) {\n      this.updateBody(body, deltaTime)\n    }\n  }\n\n  /**\n   * Update a single physics body\n   * @param {Object} body - Physics body to update\n   * @param {number} deltaTime - Time since last frame\n   */\n  updateBody(body, deltaTime) {\n    if (body.isStatic) {\n      return\n    }\n\n    // Initialize velocity if not present\n    if (!body.velocity) {\n      body.velocity = new THREE.Vector3()\n    }\n\n    // Store previous position for collision resolution\n    const previousPosition = body.position.clone()\n\n    // Apply forces based on environment\n    if (this.isUnderwater) {\n      this.underwaterPhysics.applyUnderwaterEffects(body, deltaTime)\n    } else {\n      // Apply gravity in air\n      const gravityForce = this.gravity.clone().multiplyScalar(deltaTime)\n      body.velocity.add(gravityForce)\n    }\n\n    // Apply velocity to position\n    const velocityDelta = body.velocity.clone().multiplyScalar(deltaTime)\n    body.position.add(velocityDelta)\n\n    // Check collisions and resolve\n    const collisions = this.collisionSystem.checkCollisions(body)\n    if (collisions.length > 0) {\n      this.resolveCollisions(body, collisions, previousPosition)\n    }\n  }\n\n  /**\n   * Resolve collisions for a body\n   * @param {Object} body - Physics body that collided\n   * @param {Array} collisions - Array of colliding objects\n   * @param {THREE.Vector3} previousPosition - Position before collision\n   */\n  resolveCollisions(body, collisions, previousPosition) {\n    // Check if any collisions are with collectibles or gates that should not block movement\n    const blockingCollisions = collisions.filter(\n      collision =>\n        (collision.type !== 'collectible' || collision.collected) &&\n        collision.type !== 'gate'\n    )\n\n    // Only revert position and stop movement for blocking collisions\n    if (blockingCollisions.length > 0) {\n      // Simple collision resolution: revert to previous position and stop movement\n      body.position.copy(previousPosition)\n\n      // Reduce velocity on collision (bounce/friction)\n      body.velocity.multiplyScalar(0.3)\n    }\n\n    // Notify collision callbacks if present (for all collisions)\n    if (body.onCollision) {\n      body.onCollision(collisions)\n    }\n  }\n\n  /**\n   * Check collisions for all bodies\n   * @returns {Array} Array of collision pairs\n   */\n  checkCollisions() {\n    const collisionPairs = []\n\n    for (let i = 0; i < this.rigidBodies.length; i++) {\n      const bodyA = this.rigidBodies[i]\n      const collisions = this.collisionSystem.checkCollisions(bodyA)\n\n      for (const bodyB of collisions) {\n        collisionPairs.push([bodyA, bodyB])\n      }\n    }\n\n    return collisionPairs\n  }\n\n  /**\n   * Create a sphere collision body\n   * @param {THREE.Vector3} position - Position of the sphere\n   * @param {number} radius - Radius of the sphere\n   * @param {boolean} isStatic - Whether the body is static\n   * @returns {Object} Collision body\n   */\n  createSphereBody(position, radius, isStatic = false) {\n    return {\n      position: position.clone(),\n      velocity: new THREE.Vector3(),\n      collisionType: 'sphere',\n      radius: radius,\n      isStatic: isStatic,\n    }\n  }\n\n  /**\n   * Create a box collision body\n   * @param {THREE.Vector3} position - Position of the box\n   * @param {THREE.Vector3} size - Size of the box\n   * @param {boolean} isStatic - Whether the body is static\n   * @returns {Object} Collision body\n   */\n  createBoxBody(position, size, isStatic = false) {\n    return {\n      position: position.clone(),\n      velocity: new THREE.Vector3(),\n      collisionType: 'box',\n      size: size.clone(),\n      isStatic: isStatic,\n    }\n  }\n}\n","/**\n * Particle System for Ocean Adventure\n *\n * Creates underwater atmosphere with bubbles, light rays,\n * and collection effects for enhanced immersion.\n */\n\nimport * as THREE from 'three'\n\n/**\n * Individual particle class\n */\nclass Particle {\n  constructor(position, velocity, life, size, color) {\n    this.position = position.clone()\n    this.velocity = velocity.clone()\n    this.life = life\n    this.maxLife = life\n    this.size = size\n    this.color = color.clone()\n    this.alpha = 1.0\n    this.active = true\n  }\n\n  /**\n   * Update particle state\n   * @param {number} deltaTime - Time since last frame\n   */\n  update(deltaTime) {\n    if (!this.active) {\n      return\n    }\n\n    // Update position\n    this.position.add(this.velocity.clone().multiplyScalar(deltaTime))\n\n    // Update life\n    this.life -= deltaTime\n\n    // Update alpha based on life remaining\n    this.alpha = this.life / this.maxLife\n\n    // Deactivate particle if life is over\n    if (this.life <= 0) {\n      this.active = false\n    }\n  }\n\n  /**\n   * Reset particle with new properties\n   * @param {THREE.Vector3} position - New position\n   * @param {THREE.Vector3} velocity - New velocity\n   * @param {number} life - New life span\n   * @param {number} size - New size\n   * @param {THREE.Color} color - New color\n   */\n  reset(position, velocity, life, size, color) {\n    this.position.copy(position)\n    this.velocity.copy(velocity)\n    this.life = life\n    this.maxLife = life\n    this.size = size\n    this.color.copy(color)\n    this.alpha = 1.0\n    this.active = true\n  }\n}\n\n/**\n * Main particle system class\n */\nexport class ParticleSystem {\n  constructor(scene, maxParticles = 1000) {\n    this.scene = scene\n    this.maxParticles = maxParticles\n    this.particles = []\n    this.emitters = []\n\n    // Create particle pool\n    this.initializeParticlePool()\n\n    // Create particle geometry and material\n    this.createParticleRenderSystem()\n\n    // Add default underwater emitters\n    this.createUnderwaterEmitters()\n  }\n\n  /**\n   * Initialize the particle pool for object reuse\n   */\n  initializeParticlePool() {\n    for (let i = 0; i < this.maxParticles; i++) {\n      const particle = new Particle(\n        new THREE.Vector3(),\n        new THREE.Vector3(),\n        1.0,\n        1.0,\n        new THREE.Color(0xffffff)\n      )\n      particle.active = false\n      this.particles.push(particle)\n    }\n  }\n\n  /**\n   * Create the rendering system for particles\n   */\n  createParticleRenderSystem() {\n    // Create geometry for point sprites\n    this.geometry = new THREE.BufferGeometry()\n\n    // Create arrays for particle attributes\n    this.positions = new Float32Array(this.maxParticles * 3)\n    this.colors = new Float32Array(this.maxParticles * 3)\n    this.sizes = new Float32Array(this.maxParticles)\n    this.alphas = new Float32Array(this.maxParticles)\n\n    // Set attributes\n    this.geometry.setAttribute(\n      'position',\n      new THREE.BufferAttribute(this.positions, 3)\n    )\n    this.geometry.setAttribute(\n      'color',\n      new THREE.BufferAttribute(this.colors, 3)\n    )\n    this.geometry.setAttribute('size', new THREE.BufferAttribute(this.sizes, 1))\n    this.geometry.setAttribute(\n      'alpha',\n      new THREE.BufferAttribute(this.alphas, 1)\n    )\n\n    // Create shader material for better underwater effects\n    this.material = new THREE.ShaderMaterial({\n      uniforms: {\n        time: { value: 0.0 },\n        pointTexture: { value: this.createParticleTexture() },\n      },\n      vertexShader: `\n        attribute float size;\n        attribute float alpha;\n        attribute vec3 color;\n        \n        varying float vAlpha;\n        varying vec3 vColor;\n        \n        void main() {\n          vAlpha = alpha;\n          vColor = color;\n          \n          vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n          gl_PointSize = size * (300.0 / -mvPosition.z);\n          gl_Position = projectionMatrix * mvPosition;\n        }\n      `,\n      fragmentShader: `\n        uniform sampler2D pointTexture;\n        \n        varying float vAlpha;\n        varying vec3 vColor;\n        \n        void main() {\n          vec4 texColor = texture2D(pointTexture, gl_PointCoord);\n          gl_FragColor = vec4(vColor, vAlpha * texColor.a);\n        }\n      `,\n      transparent: true,\n      blending: THREE.AdditiveBlending,\n      depthWrite: false,\n    })\n\n    // Create points object\n    this.points = new THREE.Points(this.geometry, this.material)\n    this.scene.add(this.points)\n  }\n\n  /**\n   * Create texture for particles\n   * @returns {THREE.Texture} Particle texture\n   */\n  createParticleTexture() {\n    const canvas = document.createElement('canvas')\n    canvas.width = 64\n    canvas.height = 64\n\n    const context = canvas.getContext('2d')\n    const gradient = context.createRadialGradient(32, 32, 0, 32, 32, 32)\n    gradient.addColorStop(0, 'rgba(255,255,255,1)')\n    gradient.addColorStop(0.2, 'rgba(255,255,255,0.8)')\n    gradient.addColorStop(0.4, 'rgba(255,255,255,0.4)')\n    gradient.addColorStop(1, 'rgba(255,255,255,0)')\n\n    context.fillStyle = gradient\n    context.fillRect(0, 0, 64, 64)\n\n    const texture = new THREE.Texture(canvas)\n    texture.needsUpdate = true\n    return texture\n  }\n\n  /**\n   * Create underwater particle emitters\n   */\n  createUnderwaterEmitters() {\n    // Bubble emitter\n    this.addEmitter({\n      type: 'bubbles',\n      position: new THREE.Vector3(0, -10, 0),\n      rate: 5, // particles per second\n      life: 8.0,\n      size: { min: 2, max: 6 },\n      velocity: new THREE.Vector3(0, 2, 0),\n      velocityVariation: new THREE.Vector3(0.5, 0.5, 0.5),\n      color: new THREE.Color(0x87ceeb),\n      colorVariation: 0.1,\n      area: new THREE.Vector3(20, 2, 20), // Emission area\n    })\n\n    // Floating particles (debris/plankton)\n    this.addEmitter({\n      type: 'debris',\n      position: new THREE.Vector3(0, 0, 0),\n      rate: 3,\n      life: 15.0,\n      size: { min: 1, max: 3 },\n      velocity: new THREE.Vector3(0.1, 0.05, 0.1),\n      velocityVariation: new THREE.Vector3(0.3, 0.2, 0.3),\n      color: new THREE.Color(0xffffff),\n      colorVariation: 0.2,\n      area: new THREE.Vector3(40, 20, 40),\n    })\n\n    // Light rays effect (very sparse)\n    this.addEmitter({\n      type: 'lightRays',\n      position: new THREE.Vector3(0, 15, 0),\n      rate: 0.5,\n      life: 20.0,\n      size: { min: 8, max: 15 },\n      velocity: new THREE.Vector3(0, -0.5, 0),\n      velocityVariation: new THREE.Vector3(0.1, 0.2, 0.1),\n      color: new THREE.Color(0xffd700),\n      colorVariation: 0.1,\n      area: new THREE.Vector3(30, 5, 30),\n    })\n  }\n\n  /**\n   * Add a particle emitter\n   * @param {Object} emitterConfig - Configuration for the emitter\n   */\n  addEmitter(emitterConfig) {\n    const emitter = {\n      ...emitterConfig,\n      accumulator: 0.0, // For rate control\n      active: true,\n    }\n    this.emitters.push(emitter)\n  }\n\n  /**\n   * Emit a single particle\n   * @param {Object} emitter - Emitter configuration\n   */\n  emitParticle(emitter) {\n    // Find inactive particle\n    const particle = this.particles.find(p => !p.active)\n    if (!particle) {\n      return\n    } // No available particles\n\n    // Calculate random position within emission area\n    const position = emitter.position\n      .clone()\n      .add(\n        new THREE.Vector3(\n          (Math.random() - 0.5) * emitter.area.x,\n          (Math.random() - 0.5) * emitter.area.y,\n          (Math.random() - 0.5) * emitter.area.z\n        )\n      )\n\n    // Calculate random velocity\n    const velocity = emitter.velocity\n      .clone()\n      .add(\n        new THREE.Vector3(\n          (Math.random() - 0.5) * emitter.velocityVariation.x,\n          (Math.random() - 0.5) * emitter.velocityVariation.y,\n          (Math.random() - 0.5) * emitter.velocityVariation.z\n        )\n      )\n\n    // Calculate random size\n    const size =\n      emitter.size.min + Math.random() * (emitter.size.max - emitter.size.min)\n\n    // Calculate random color\n    const color = emitter.color.clone()\n    if (emitter.colorVariation > 0) {\n      color.offsetHSL(\n        (Math.random() - 0.5) * emitter.colorVariation,\n        0,\n        (Math.random() - 0.5) * emitter.colorVariation * 0.5\n      )\n    }\n\n    // Reset particle with new properties\n    particle.reset(position, velocity, emitter.life, size, color)\n  }\n\n  /**\n   * Create a burst of particles at a specific location\n   * @param {THREE.Vector3} position - Position to emit particles\n   * @param {Object} config - Burst configuration\n   */\n  createBurst(position, config = {}) {\n    const count = config.count || 20\n    const life = config.life || 2.0\n    const velocity = config.velocity || new THREE.Vector3(0, 1, 0)\n    const velocityVariation =\n      config.velocityVariation || new THREE.Vector3(2, 2, 2)\n    const color = config.color || new THREE.Color(0xffd700)\n    const size = config.size || { min: 2, max: 8 }\n\n    for (let i = 0; i < count; i++) {\n      const particle = this.particles.find(p => !p.active)\n      if (!particle) {\n        break\n      }\n\n      const burstVelocity = velocity\n        .clone()\n        .add(\n          new THREE.Vector3(\n            (Math.random() - 0.5) * velocityVariation.x,\n            (Math.random() - 0.5) * velocityVariation.y,\n            (Math.random() - 0.5) * velocityVariation.z\n          )\n        )\n\n      const particleSize = size.min + Math.random() * (size.max - size.min)\n\n      particle.reset(position.clone(), burstVelocity, life, particleSize, color)\n    }\n  }\n\n  /**\n   * Update particle system\n   * @param {number} deltaTime - Time since last frame\n   */\n  update(deltaTime) {\n    // Update emitters\n    for (const emitter of this.emitters) {\n      if (!emitter.active) {\n        continue\n      }\n\n      emitter.accumulator += deltaTime\n      const emissionInterval = 1.0 / emitter.rate\n\n      while (emitter.accumulator >= emissionInterval) {\n        this.emitParticle(emitter)\n        emitter.accumulator -= emissionInterval\n      }\n    }\n\n    // Update particles\n    let activeCount = 0\n    for (let i = 0; i < this.particles.length; i++) {\n      const particle = this.particles[i]\n\n      if (particle.active) {\n        particle.update(deltaTime)\n\n        // Update render attributes\n        const index3 = activeCount * 3\n        this.positions[index3] = particle.position.x\n        this.positions[index3 + 1] = particle.position.y\n        this.positions[index3 + 2] = particle.position.z\n\n        this.colors[index3] = particle.color.r\n        this.colors[index3 + 1] = particle.color.g\n        this.colors[index3 + 2] = particle.color.b\n\n        this.sizes[activeCount] = particle.size\n        this.alphas[activeCount] = particle.alpha\n\n        activeCount++\n      }\n    }\n\n    // Update geometry\n    this.geometry.attributes.position.needsUpdate = true\n    this.geometry.attributes.color.needsUpdate = true\n    this.geometry.attributes.size.needsUpdate = true\n    this.geometry.attributes.alpha.needsUpdate = true\n\n    // Update draw range to only render active particles\n    this.geometry.setDrawRange(0, activeCount)\n\n    // Update shader uniforms\n    this.material.uniforms.time.value += deltaTime\n  }\n\n  /**\n   * Set emitter active state\n   * @param {string} type - Emitter type\n   * @param {boolean} active - Whether emitter should be active\n   */\n  setEmitterActive(type, active) {\n    const emitter = this.emitters.find(e => e.type === type)\n    if (emitter) {\n      emitter.active = active\n    }\n  }\n\n  /**\n   * Remove all particles\n   */\n  clear() {\n    for (const particle of this.particles) {\n      particle.active = false\n    }\n  }\n\n  /**\n   * Dispose of particle system resources\n   */\n  dispose() {\n    this.scene.remove(this.points)\n    this.geometry.dispose()\n    this.material.dispose()\n    if (this.material.uniforms.pointTexture.value) {\n      this.material.uniforms.pointTexture.value.dispose()\n    }\n  }\n}\n","/**\n * Audio Engine for Ocean Adventure\n *\n * Handles underwater ambient sounds, sound effects, and 3D spatial audio\n * using Web Audio API for immersive underwater experience.\n */\n\nexport class AudioEngine {\n  constructor() {\n    this.audioContext = null\n    this.listener = null\n    this.sounds = new Map()\n    this.isInitialized = false\n    this.isMuted = false\n    this.masterVolume = 0.5\n\n    // Separate volume controls\n    this.musicVolume = 0.5\n    this.sfxVolume = 0.5\n\n    // Audio settings\n    this.underwaterFilterFrequency = 800 // Low-pass filter for underwater effect\n    this.reverbAmount = 0.3\n\n    // Load saved settings\n    this.loadSettings()\n\n    console.log('ðŸ”Š AudioEngine created')\n  }\n\n  /**\n   * Initialize the audio system\n   * Note: Must be called after user interaction due to browser autoplay policies\n   */\n  async initialize() {\n    try {\n      // Create audio context\n      this.audioContext = new (window.AudioContext ||\n        window.webkitAudioContext)()\n\n      // Create audio listener for 3D spatial audio\n      this.listener = this.audioContext.listener\n\n      // Create master gain node for volume control\n      this.masterGain = this.audioContext.createGain()\n      this.masterGain.gain.setValueAtTime(\n        this.masterVolume,\n        this.audioContext.currentTime\n      )\n      this.masterGain.connect(this.audioContext.destination)\n\n      // Create separate gain nodes for music and sound effects\n      this.musicGain = this.audioContext.createGain()\n      this.sfxGain = this.audioContext.createGain()\n\n      this.musicGain.gain.setValueAtTime(\n        this.musicVolume,\n        this.audioContext.currentTime\n      )\n      this.sfxGain.gain.setValueAtTime(\n        this.sfxVolume,\n        this.audioContext.currentTime\n      )\n\n      this.musicGain.connect(this.masterGain)\n      this.sfxGain.connect(this.masterGain)\n\n      // Create underwater effect chain\n      this.createUnderwaterEffects()\n\n      // Load basic sound effects (using simple oscillators for now - avoiding file dependencies)\n      this.createSoundEffects()\n\n      this.isInitialized = true\n      console.log('âœ… AudioEngine initialized successfully')\n    } catch (error) {\n      console.warn('âš ï¸ AudioEngine initialization failed:', error)\n      // Graceful fallback - game continues without audio\n    }\n  }\n\n  /**\n   * Create underwater audio effects (reverb, low-pass filter)\n   */\n  createUnderwaterEffects() {\n    if (!this.audioContext) {\n      return\n    }\n\n    // Low-pass filter for muffled underwater sound\n    this.underwaterFilter = this.audioContext.createBiquadFilter()\n    this.underwaterFilter.type = 'lowpass'\n    this.underwaterFilter.frequency.setValueAtTime(\n      this.underwaterFilterFrequency,\n      this.audioContext.currentTime\n    )\n    this.underwaterFilter.Q.setValueAtTime(1, this.audioContext.currentTime)\n\n    // Connect filter to master gain\n    this.underwaterFilter.connect(this.masterGain)\n\n    console.log('ðŸŒŠ Underwater audio effects created')\n  }\n\n  /**\n   * Create enhanced sound effects using oscillators and filters\n   * This avoids external file dependencies while providing rich audio feedback\n   */\n  createSoundEffects() {\n    if (!this.audioContext) {\n      return\n    }\n\n    // Enhanced sound configurations with more complex patterns\n    this.soundConfigs = {\n      starCollect: {\n        type: 'sine',\n        frequency: 880,\n        duration: 0.4,\n        volume: 0.3,\n        envelope: { attack: 0.01, decay: 0.1, sustain: 0.8, release: 0.3 },\n        harmonics: [\n          { frequency: 1320, volume: 0.5 },\n          { frequency: 1760, volume: 0.3 },\n        ],\n      },\n      gateActivate: {\n        type: 'triangle',\n        frequency: 220,\n        duration: 1.5,\n        volume: 0.4,\n        envelope: { attack: 0.2, decay: 0.3, sustain: 0.7, release: 0.5 },\n        modulation: { frequency: 4, depth: 20 },\n      },\n      levelComplete: {\n        type: 'square',\n        frequency: 440,\n        duration: 2.5,\n        volume: 0.5,\n        envelope: { attack: 0.1, decay: 0.2, sustain: 0.8, release: 0.4 },\n        melody: [440, 554.37, 659.25, 880], // A4, C#5, E5, A5\n      },\n      swimming: {\n        type: 'sine',\n        frequency: 200,\n        duration: 0.2,\n        volume: 0.15,\n        envelope: { attack: 0.05, decay: 0.1, sustain: 0.5, release: 0.05 },\n      },\n      underwater: {\n        type: 'sine',\n        frequency: 80,\n        duration: -1, // Continuous\n        volume: 0.12,\n        envelope: { attack: 2.0, decay: 0, sustain: 1.0, release: 2.0 },\n        modulation: { frequency: 0.3, depth: 5 },\n      },\n    }\n\n    console.log('ðŸŽµ Enhanced sound effects configured')\n  }\n\n  /**\n   * Play an enhanced sound effect with envelopes and harmonics\n   */\n  playSound(soundName, position = null) {\n    if (!this.isInitialized || this.isMuted || !this.audioContext) {\n      return\n    }\n\n    const config = this.soundConfigs[soundName]\n    if (!config) {\n      console.warn(`Sound \"${soundName}\" not found`)\n      return\n    }\n\n    try {\n      const currentTime = this.audioContext.currentTime\n\n      // Handle melody-based sounds (like levelComplete)\n      if (config.melody) {\n        this.playMelody(config, position)\n        return\n      }\n\n      // Create main oscillator\n      const oscillator = this.audioContext.createOscillator()\n      const gainNode = this.audioContext.createGain()\n\n      // Configure oscillator\n      oscillator.type = config.type\n      oscillator.frequency.setValueAtTime(config.frequency, currentTime)\n\n      // Add frequency modulation if specified\n      if (config.modulation) {\n        const lfo = this.audioContext.createOscillator()\n        const lfoGain = this.audioContext.createGain()\n        lfo.frequency.setValueAtTime(config.modulation.frequency, currentTime)\n        lfoGain.gain.setValueAtTime(config.modulation.depth, currentTime)\n        lfo.connect(lfoGain)\n        lfoGain.connect(oscillator.frequency)\n        lfo.start(currentTime)\n        if (config.duration > 0) {\n          lfo.stop(currentTime + config.duration)\n        }\n      }\n\n      // Configure ADSR envelope\n      const envelope = config.envelope || {\n        attack: 0.01,\n        decay: 0.1,\n        sustain: 0.8,\n        release: 0.2,\n      }\n      const attackTime = currentTime + envelope.attack\n      const decayTime = attackTime + envelope.decay\n      const sustainLevel = config.volume * envelope.sustain\n      const releaseTime =\n        config.duration > 0 ? currentTime + config.duration : currentTime + 1\n\n      gainNode.gain.setValueAtTime(0, currentTime)\n      gainNode.gain.linearRampToValueAtTime(config.volume, attackTime)\n      gainNode.gain.linearRampToValueAtTime(sustainLevel, decayTime)\n      gainNode.gain.setValueAtTime(sustainLevel, releaseTime - envelope.release)\n      gainNode.gain.linearRampToValueAtTime(0, releaseTime)\n\n      // Connect audio chain\n      oscillator.connect(gainNode)\n\n      // Add harmonics for richer sound\n      const harmonicOscillators = []\n      if (config.harmonics) {\n        config.harmonics.forEach(harmonic => {\n          const harmonicOsc = this.audioContext.createOscillator()\n          const harmonicGain = this.audioContext.createGain()\n\n          harmonicOsc.type = config.type\n          harmonicOsc.frequency.setValueAtTime(harmonic.frequency, currentTime)\n          harmonicGain.gain.setValueAtTime(\n            harmonic.volume * config.volume,\n            currentTime\n          )\n          harmonicGain.gain.linearRampToValueAtTime(0, releaseTime)\n\n          harmonicOsc.connect(harmonicGain)\n          harmonicGain.connect(gainNode)\n          harmonicOsc.start(currentTime)\n\n          if (config.duration > 0) {\n            harmonicOsc.stop(releaseTime)\n          }\n          harmonicOscillators.push(harmonicOsc)\n        })\n      }\n\n      // Add 3D positioning if position provided\n      if (position) {\n        const panner = this.audioContext.createPanner()\n        panner.panningModel = 'HRTF'\n        panner.setPosition(position.x, position.y, position.z)\n        gainNode.connect(panner)\n        panner.connect(this.underwaterFilter)\n        this.underwaterFilter.connect(this.sfxGain)\n      } else {\n        gainNode.connect(this.underwaterFilter)\n        this.underwaterFilter.connect(this.sfxGain)\n      }\n\n      // Start and stop the sound\n      oscillator.start(currentTime)\n      if (config.duration > 0) {\n        oscillator.stop(releaseTime)\n      }\n\n      console.log(`ðŸ”Š Playing enhanced sound: ${soundName}`)\n    } catch (error) {\n      console.warn(`Failed to play sound \"${soundName}\":`, error)\n    }\n  }\n\n  /**\n   * Play a melody sequence\n   */\n  playMelody(config, position = null) {\n    const noteDuration = config.duration / config.melody.length\n\n    config.melody.forEach((frequency, index) => {\n      const startTime = this.audioContext.currentTime + index * noteDuration\n\n      const oscillator = this.audioContext.createOscillator()\n      const gainNode = this.audioContext.createGain()\n\n      oscillator.type = config.type\n      oscillator.frequency.setValueAtTime(frequency, startTime)\n\n      gainNode.gain.setValueAtTime(0, startTime)\n      gainNode.gain.linearRampToValueAtTime(config.volume, startTime + 0.05)\n      gainNode.gain.linearRampToValueAtTime(0, startTime + noteDuration - 0.05)\n\n      oscillator.connect(gainNode)\n\n      if (position) {\n        const panner = this.audioContext.createPanner()\n        panner.panningModel = 'HRTF'\n        panner.setPosition(position.x, position.y, position.z)\n        gainNode.connect(panner)\n        panner.connect(this.underwaterFilter)\n        this.underwaterFilter.connect(this.sfxGain)\n      } else {\n        gainNode.connect(this.underwaterFilter)\n        this.underwaterFilter.connect(this.sfxGain)\n      }\n\n      oscillator.start(startTime)\n      oscillator.stop(startTime + noteDuration)\n    })\n  }\n\n  /**\n   * Start enhanced ambient underwater sound with background music\n   */\n  startAmbientSound() {\n    if (!this.isInitialized || this.isMuted) {\n      return\n    }\n\n    // Only start if not already playing\n    if (this.ambientOscillator) {\n      return\n    }\n\n    try {\n      // Create main ambient sound (underwater rumble)\n      this.ambientOscillator = this.audioContext.createOscillator()\n      this.ambientGain = this.audioContext.createGain()\n\n      this.ambientOscillator.type = 'sine'\n      this.ambientOscillator.frequency.setValueAtTime(\n        60,\n        this.audioContext.currentTime\n      )\n\n      // Gentle fade in\n      this.ambientGain.gain.setValueAtTime(0, this.audioContext.currentTime)\n      this.ambientGain.gain.linearRampToValueAtTime(\n        0.08,\n        this.audioContext.currentTime + 3.0\n      )\n\n      this.ambientOscillator.connect(this.ambientGain)\n      this.ambientGain.connect(this.underwaterFilter)\n      this.underwaterFilter.connect(this.musicGain)\n\n      this.ambientOscillator.start()\n\n      // Create background music layers\n      this.createBackgroundMusic()\n\n      console.log('ðŸŒŠ Ambient underwater sound and music started')\n    } catch (error) {\n      console.warn('Failed to start ambient sound:', error)\n    }\n  }\n\n  /**\n   * Create layered background music using harmonic oscillators\n   */\n  createBackgroundMusic() {\n    this.musicLayers = []\n\n    // Musical notes in the key of A minor (underwater/mysterious feel)\n    const musicNotes = [\n      { frequency: 110, volume: 0.03, type: 'sine' }, // A2\n      { frequency: 146.83, volume: 0.025, type: 'sine' }, // D3\n      { frequency: 164.81, volume: 0.02, type: 'triangle' }, // E3\n      { frequency: 220, volume: 0.015, type: 'sine' }, // A3\n    ]\n\n    musicNotes.forEach((note, index) => {\n      const oscillator = this.audioContext.createOscillator()\n      const gainNode = this.audioContext.createGain()\n      const lfo = this.audioContext.createOscillator() // Low frequency oscillator for modulation\n      const lfoGain = this.audioContext.createGain()\n\n      // Setup main oscillator\n      oscillator.type = note.type\n      oscillator.frequency.setValueAtTime(\n        note.frequency,\n        this.audioContext.currentTime\n      )\n\n      // Setup LFO for subtle frequency modulation\n      lfo.type = 'sine'\n      lfo.frequency.setValueAtTime(\n        0.1 + index * 0.05,\n        this.audioContext.currentTime\n      ) // Different rates for each layer\n      lfoGain.gain.setValueAtTime(2, this.audioContext.currentTime) // Small modulation depth\n\n      // Connect modulation\n      lfo.connect(lfoGain)\n      lfoGain.connect(oscillator.frequency)\n\n      // Setup volume envelope with slow fade in\n      gainNode.gain.setValueAtTime(0, this.audioContext.currentTime)\n      gainNode.gain.linearRampToValueAtTime(\n        note.volume,\n        this.audioContext.currentTime + 5.0 + index // Staggered entry\n      )\n\n      // Connect audio chain\n      oscillator.connect(gainNode)\n      gainNode.connect(this.underwaterFilter)\n      this.underwaterFilter.connect(this.musicGain)\n\n      // Start oscillators\n      oscillator.start()\n      lfo.start()\n\n      this.musicLayers.push({ oscillator, gainNode, lfo, lfoGain })\n    })\n  }\n\n  /**\n   * Stop ambient underwater sound and background music\n   */\n  stopAmbientSound() {\n    if (this.ambientOscillator) {\n      try {\n        this.ambientGain.gain.linearRampToValueAtTime(\n          0,\n          this.audioContext.currentTime + 1\n        )\n        this.ambientOscillator.stop(this.audioContext.currentTime + 1)\n        this.ambientOscillator = null\n        this.ambientGain = null\n      } catch (error) {\n        console.warn('Error stopping ambient sound:', error)\n      }\n    }\n\n    // Stop background music layers\n    if (this.musicLayers) {\n      this.musicLayers.forEach(layer => {\n        try {\n          layer.gainNode.gain.linearRampToValueAtTime(\n            0,\n            this.audioContext.currentTime + 1\n          )\n          layer.oscillator.stop(this.audioContext.currentTime + 1)\n          layer.lfo.stop(this.audioContext.currentTime + 1)\n        } catch (error) {\n          console.warn('Error stopping music layer:', error)\n        }\n      })\n      this.musicLayers = null\n    }\n\n    console.log('ðŸ”‡ Ambient sound and music stopped')\n  }\n\n  /**\n   * Update listener position for 3D audio (should be called each frame)\n   */\n  updateListenerPosition(position, forward, up) {\n    if (!this.listener || !this.isInitialized) {\n      return\n    }\n\n    try {\n      if (this.listener.positionX) {\n        // New Web Audio API approach\n        this.listener.positionX.setValueAtTime(\n          position.x,\n          this.audioContext.currentTime\n        )\n        this.listener.positionY.setValueAtTime(\n          position.y,\n          this.audioContext.currentTime\n        )\n        this.listener.positionZ.setValueAtTime(\n          position.z,\n          this.audioContext.currentTime\n        )\n\n        this.listener.forwardX.setValueAtTime(\n          forward.x,\n          this.audioContext.currentTime\n        )\n        this.listener.forwardY.setValueAtTime(\n          forward.y,\n          this.audioContext.currentTime\n        )\n        this.listener.forwardZ.setValueAtTime(\n          forward.z,\n          this.audioContext.currentTime\n        )\n\n        this.listener.upX.setValueAtTime(up.x, this.audioContext.currentTime)\n        this.listener.upY.setValueAtTime(up.y, this.audioContext.currentTime)\n        this.listener.upZ.setValueAtTime(up.z, this.audioContext.currentTime)\n      } else {\n        // Fallback for older browsers\n        this.listener.setPosition(position.x, position.y, position.z)\n        this.listener.setOrientation(\n          forward.x,\n          forward.y,\n          forward.z,\n          up.x,\n          up.y,\n          up.z\n        )\n      }\n    } catch {\n      // Silently ignore positioning errors\n    }\n  }\n\n  /**\n   * Set master volume\n   */\n  setMasterVolume(volume) {\n    this.masterVolume = Math.max(0, Math.min(1, volume))\n\n    if (this.masterGain && this.audioContext) {\n      this.masterGain.gain.setValueAtTime(\n        this.masterVolume,\n        this.audioContext.currentTime\n      )\n    }\n\n    this.saveSettings()\n  }\n\n  /**\n   * Set music volume\n   */\n  setMusicVolume(volume) {\n    this.musicVolume = Math.max(0, Math.min(1, volume))\n\n    if (this.musicGain && this.audioContext) {\n      this.musicGain.gain.setValueAtTime(\n        this.musicVolume,\n        this.audioContext.currentTime\n      )\n    }\n\n    this.saveSettings()\n  }\n\n  /**\n   * Set sound effects volume\n   */\n  setSfxVolume(volume) {\n    this.sfxVolume = Math.max(0, Math.min(1, volume))\n\n    if (this.sfxGain && this.audioContext) {\n      this.sfxGain.gain.setValueAtTime(\n        this.sfxVolume,\n        this.audioContext.currentTime\n      )\n    }\n\n    this.saveSettings()\n  }\n\n  /**\n   * Toggle mute state\n   */\n  toggleMute() {\n    this.isMuted = !this.isMuted\n\n    if (this.isMuted) {\n      this.stopAmbientSound()\n    } else if (this.isInitialized) {\n      this.startAmbientSound()\n    }\n\n    console.log(`ðŸ”Š Audio ${this.isMuted ? 'muted' : 'unmuted'}`)\n    return this.isMuted\n  }\n\n  /**\n   * Get current audio state\n   */\n  getState() {\n    return {\n      isInitialized: this.isInitialized,\n      isMuted: this.isMuted,\n      masterVolume: this.masterVolume,\n      musicVolume: this.musicVolume,\n      sfxVolume: this.sfxVolume,\n    }\n  }\n\n  /**\n   * Load audio settings from localStorage\n   */\n  loadSettings() {\n    try {\n      const savedSettings = localStorage.getItem('oceanAdventure_audioSettings')\n      if (savedSettings) {\n        const settings = JSON.parse(savedSettings)\n        this.masterVolume = settings.masterVolume ?? 0.5\n        this.musicVolume = settings.musicVolume ?? 0.5\n        this.sfxVolume = settings.sfxVolume ?? 0.5\n      }\n    } catch (error) {\n      console.warn('Failed to load audio settings:', error)\n    }\n  }\n\n  /**\n   * Save audio settings to localStorage\n   */\n  saveSettings() {\n    try {\n      const settings = {\n        masterVolume: this.masterVolume,\n        musicVolume: this.musicVolume,\n        sfxVolume: this.sfxVolume,\n      }\n      localStorage.setItem(\n        'oceanAdventure_audioSettings',\n        JSON.stringify(settings)\n      )\n    } catch (error) {\n      console.warn('Failed to save audio settings:', error)\n    }\n  }\n\n  /**\n   * Dispose of audio resources\n   */\n  dispose() {\n    this.stopAmbientSound()\n\n    if (this.audioContext && this.audioContext.state !== 'closed') {\n      this.audioContext.close()\n    }\n\n    this.sounds.clear()\n    this.isInitialized = false\n\n    console.log('ðŸ—‘ï¸ AudioEngine disposed')\n  }\n}\n","/**\n * Player Component for Ocean Adventure\n *\n * Enhanced player controller with physics integration,\n * underwater movement mechanics, and collision handling.\n */\n\nimport * as THREE from 'three'\n\nexport class Player {\n  constructor(scene, physicsEngine) {\n    this.scene = scene\n    this.physicsEngine = physicsEngine\n\n    // Player properties\n    this.moveSpeed = 8.0\n    this.rotationSpeed = 3.0\n    this.maxVelocity = 5.0\n\n    // Movement state\n    this.movementVector = new THREE.Vector3()\n    this.isMoving = false\n\n    // Create player mesh and physics body\n    this.createPlayerMesh()\n    this.createPhysicsBody()\n\n    // Bind collision handler\n    this.physicsBody.onCollision = collisions =>\n      this.handleCollisions(collisions)\n  }\n\n  /**\n   * Create the visual representation of the player\n   */\n  createPlayerMesh() {\n    // Create player geometry (capsule for better collision detection)\n    const geometry = new THREE.CapsuleGeometry(0.5, 1.5, 4, 8)\n\n    // Use MeshPhongMaterial for better lighting effects\n    const material = new THREE.MeshPhongMaterial({\n      color: 0x00ff88,\n      transparent: true,\n      opacity: 0.9,\n      shininess: 50,\n      specular: 0x44aa66,\n      emissive: 0x002211,\n      emissiveIntensity: 0.1,\n    })\n\n    this.mesh = new THREE.Mesh(geometry, material)\n    this.mesh.castShadow = true\n    this.mesh.receiveShadow = true\n\n    // Set initial position - start deep underwater for blue glow effect\n    this.mesh.position.set(0, -8, 0) // Start 13 meters below water surface (5 - (-8) = 13m depth)\n\n    // Add to scene\n    this.scene.add(this.mesh)\n  }\n\n  /**\n   * Create physics body for collision detection and movement\n   */\n  createPhysicsBody() {\n    this.physicsBody = this.physicsEngine.createSphereBody(\n      this.mesh.position.clone(), // Use the mesh position which is now set to (0, 2, 0)\n      1.0, // Increased from 0.7 to 1.0 for better collision detection\n      false // Not static - player can move\n    )\n\n    // Add physics body to engine\n    this.physicsEngine.addRigidBody(this.physicsBody)\n  }\n\n  /**\n   * Handle input and update movement vector\n   * @param {Object} inputState - Current input state\n   */\n  handleInput(inputState) {\n    // Reset movement vector\n    this.movementVector.set(0, 0, 0)\n    this.isMoving = false\n\n    // Keyboard input\n    if (inputState.keys) {\n      if (inputState.keys.forward) {\n        this.movementVector.z -= 1\n        this.isMoving = true\n      }\n      if (inputState.keys.backward) {\n        this.movementVector.z += 1\n        this.isMoving = true\n      }\n      if (inputState.keys.left) {\n        this.movementVector.x -= 1\n        this.isMoving = true\n      }\n      if (inputState.keys.right) {\n        this.movementVector.x += 1\n        this.isMoving = true\n      }\n      if (inputState.keys.up) {\n        this.movementVector.y += 1\n        this.isMoving = true\n      }\n      if (inputState.keys.down) {\n        this.movementVector.y -= 1\n        this.isMoving = true\n      }\n    }\n\n    // Touch/mobile input\n    if (inputState.joystick) {\n      this.movementVector.x += inputState.joystick.x\n      this.movementVector.z += inputState.joystick.y\n      if (\n        Math.abs(inputState.joystick.x) > 0.1 ||\n        Math.abs(inputState.joystick.y) > 0.1\n      ) {\n        this.isMoving = true\n      }\n    }\n\n    // Mobile buttons\n    if (inputState.mobileButtons) {\n      if (inputState.mobileButtons.swimUp) {\n        this.movementVector.y += 1\n        this.isMoving = true\n      }\n      if (inputState.mobileButtons.swimDown) {\n        this.movementVector.y -= 1\n        this.isMoving = true\n      }\n    }\n\n    // Normalize movement vector to prevent faster diagonal movement\n    if (this.movementVector.length() > 1) {\n      this.movementVector.normalize()\n    }\n\n    // Apply movement to physics body\n    this.applyMovement()\n  }\n\n  /**\n   * Apply movement forces to the physics body\n   */\n  applyMovement() {\n    if (!this.isMoving) {\n      // Apply stronger drag when not actively moving\n      this.physicsBody.velocity.multiplyScalar(0.9)\n      return\n    }\n\n    // Calculate movement force\n    const force = this.movementVector\n      .clone()\n      .multiplyScalar(this.moveSpeed * 0.05) // Increased force for better responsiveness\n\n    // Add force to velocity\n    this.physicsBody.velocity.add(force)\n\n    // Clamp velocity to max speed\n    if (this.physicsBody.velocity.length() > this.maxVelocity) {\n      this.physicsBody.velocity.normalize().multiplyScalar(this.maxVelocity)\n    }\n\n    // Rotate player to face movement direction (optional visual enhancement)\n    if (this.movementVector.length() > 0.1) {\n      const targetRotation = Math.atan2(\n        this.movementVector.x,\n        this.movementVector.z\n      )\n      this.mesh.rotation.y = THREE.MathUtils.lerp(\n        this.mesh.rotation.y,\n        targetRotation,\n        this.rotationSpeed * 0.016\n      )\n    }\n  }\n\n  /**\n   * Update player state\n   */\n  update() {\n    // Sync mesh position with physics body (don't override physics with floating animation)\n    this.mesh.position.copy(this.physicsBody.position)\n\n    // Add gentle floating animation to visual representation only\n    const time = Date.now() * 0.001\n    const floatingOffset = Math.sin(time * 2) * 0.02\n    this.mesh.position.y += floatingOffset\n\n    // Don't update physics body position from mesh - let physics handle position\n    // The physics body position should be authoritative\n  }\n\n  /**\n   * Handle collisions with other objects\n   * @param {Array} collisions - Array of objects the player collided with\n   */\n  handleCollisions(collisions) {\n    for (const collision of collisions) {\n      // Handle different types of collisions\n      if (collision.type === 'collectible') {\n        this.handleCollectibleCollision(collision)\n      } else if (collision.type === 'obstacle') {\n        this.handleObstacleCollision(collision)\n      } else if (collision.type === 'environment') {\n        this.handleEnvironmentCollision(collision)\n      }\n    }\n  }\n\n  /**\n   * Handle collision with collectible items\n   * @param {Object} collectible - Collectible object\n   */\n  handleCollectibleCollision(collectible) {\n    // Collectibles will be handled by the game manager\n    // This is just for reference and future expansion\n    console.log('Player collected item:', collectible)\n  }\n\n  /**\n   * Handle collision with obstacles\n   * @param {Object} obstacle - Obstacle object\n   */\n  handleObstacleCollision(obstacle) {\n    // Bounce back slightly from obstacles\n    const direction = this.physicsBody.position\n      .clone()\n      .sub(obstacle.position)\n      .normalize()\n\n    this.physicsBody.velocity.add(direction.multiplyScalar(2))\n  }\n\n  /**\n   * Handle collision with environment objects\n   * @param {Object} _envObject - Environment object (unused for now)\n   */\n  handleEnvironmentCollision() {\n    // Environment collisions are handled by physics engine\n    // This can be used for special effects or sounds\n  }\n\n  /**\n   * Get current player position\n   * @returns {THREE.Vector3} Current position\n   */\n  getPosition() {\n    // Return physics body position (authoritative) instead of mesh position (includes floating animation)\n    return this.physicsBody.position.clone()\n  }\n\n  /**\n   * Set player position\n   * @param {THREE.Vector3} position - New position\n   */\n  setPosition(position) {\n    this.mesh.position.copy(position)\n    this.physicsBody.position.copy(position)\n  }\n\n  /**\n   * Get current velocity\n   * @returns {THREE.Vector3} Current velocity\n   */\n  getVelocity() {\n    return this.physicsBody.velocity.clone()\n  }\n\n  /**\n   * Check if player is moving\n   * @returns {boolean} Whether player is currently moving\n   */\n  getIsMoving() {\n    return this.isMoving || this.physicsBody.velocity.length() > 0.1\n  }\n\n  /**\n   * Dispose of player resources\n   */\n  dispose() {\n    // Remove from physics engine\n    this.physicsEngine.removeRigidBody(this.physicsBody)\n\n    // Remove mesh from scene\n    this.scene.remove(this.mesh)\n\n    // Dispose geometry and material\n    this.mesh.geometry.dispose()\n    this.mesh.material.dispose()\n  }\n}\n","/**\n * Gate Component for Ocean Adventure\n *\n * Represents the glowing portal gates that players must swim through\n * to complete levels after collecting all stars.\n */\n\nimport * as THREE from 'three'\n\nexport class Gate {\n  constructor(scene, physicsEngine, position = new THREE.Vector3(0, 0, -15)) {\n    this.scene = scene\n    this.physicsEngine = physicsEngine\n    this.position = position.clone()\n\n    // Gate properties\n    this.width = 4\n    this.height = 6\n    this.depth = 0.5\n    this.isActivated = false\n    this.isCollected = false\n\n    // Animation properties\n    this.pulseSpeed = 0.02\n    this.rotationSpeed = 0.01\n    this.time = 0\n\n    // Create gate mesh and physics body\n    this.createGateMesh()\n    this.createPhysicsBody()\n\n    console.log('ðŸšª Gate created at position:', position)\n  }\n\n  /**\n   * Create the visual representation of the gate\n   */\n  createGateMesh() {\n    // Create gate frame (torus shape for portal effect)\n    const gateGeometry = new THREE.TorusGeometry(this.width, 0.3, 8, 32)\n\n    // Enhanced glowing material with stronger emissive properties\n    const gateMaterial = new THREE.MeshPhongMaterial({\n      color: 0x00ffff,\n      emissive: 0x006666,\n      emissiveIntensity: 0.5,\n      transparent: true,\n      opacity: 0.9,\n      shininess: 100,\n    })\n\n    this.gateMesh = new THREE.Mesh(gateGeometry, gateMaterial)\n    this.gateMesh.position.copy(this.position)\n    this.gateMesh.castShadow = true\n    this.gateMesh.receiveShadow = true\n\n    // Create inner portal effect with enhanced materials\n    const portalGeometry = new THREE.PlaneGeometry(\n      this.width * 1.5,\n      this.height\n    )\n    const portalMaterial = new THREE.MeshBasicMaterial({\n      color: 0x0088ff,\n      transparent: true,\n      opacity: 0.3,\n      side: THREE.DoubleSide,\n    })\n\n    this.portalMesh = new THREE.Mesh(portalGeometry, portalMaterial)\n    this.portalMesh.position.copy(this.position)\n\n    // Create multiple enhanced light sources for better illumination\n    this.gateLight = new THREE.PointLight(0x00ffff, 1.0, 25)\n    this.gateLight.position.copy(this.position)\n    this.gateLight.position.z += 1\n\n    // Add secondary lights for rim lighting effect\n    this.rimLights = []\n    const numRimLights = 6\n    for (let i = 0; i < numRimLights; i++) {\n      const angle = (i / numRimLights) * Math.PI * 2\n      const rimLight = new THREE.PointLight(0x0088ff, 0.3, 10)\n      const lightRadius = this.width * 1.2\n      rimLight.position.set(\n        this.position.x + Math.cos(angle) * lightRadius,\n        this.position.y + Math.sin(angle) * lightRadius * 0.7,\n        this.position.z + (Math.random() - 0.5) * 2\n      )\n      rimLight.userData = {\n        originalAngle: angle,\n        animationOffset: Math.random() * Math.PI * 2,\n      }\n      this.rimLights.push(rimLight)\n    }\n\n    // Add to scene (initially invisible until activated)\n    this.setVisibility(false)\n  }\n\n  /**\n   * Create physics body for collision detection\n   * Using a ring shape instead of a solid box to allow swimming through\n   */\n  createPhysicsBody() {\n    // Create multiple collision bodies around the ring\n    // This allows detection when player swims through the gate center\n    this.physicsBody = []\n\n    // Position collision spheres at the inner edge of the torus opening\n    // Visual gate: TorusGeometry(4, 0.3) means major radius 4, tube radius 0.3\n    // Inner opening radius = major radius - tube radius = 4 - 0.3 = 3.7\n    // Place collision spheres slightly inside the opening at radius 3.2 to ensure detection\n    const ringRadius = this.width - 0.8 // Places spheres at radius 3.2 for reliable detection\n    const segments = 8\n\n    for (let i = 0; i < segments; i++) {\n      const angle = (i / segments) * Math.PI * 2\n      const x = Math.cos(angle) * ringRadius\n      const y = Math.sin(angle) * ringRadius * 0.7 // Make it more oval for height\n\n      const segmentPosition = this.position.clone()\n      segmentPosition.x += x\n      segmentPosition.y += y\n\n      const segmentBody = this.physicsEngine.createSphereBody(\n        segmentPosition,\n        2.0, // Increased from 1.0 to 2.0 for better collision coverage\n        true // Static - gates don't move\n      )\n      segmentBody.type = 'gate'\n      segmentBody.gate = this\n      this.physicsEngine.addRigidBody(segmentBody)\n      this.physicsBody.push(segmentBody)\n    }\n\n    // Add a central collision body to detect when player swims through the gate center\n    const centerBody = this.physicsEngine.createSphereBody(\n      this.position.clone(), // Position at gate center\n      3.0, // Increased from 1.5 to 3.0 for easier collision detection\n      true // Static - gates don't move\n    )\n    centerBody.type = 'gate'\n    centerBody.gate = this\n    this.physicsEngine.addRigidBody(centerBody)\n    this.physicsBody.push(centerBody)\n  }\n\n  /**\n   * Activate the gate (make it visible and interactive)\n   */\n  activate() {\n    if (this.isActivated) {\n      return\n    }\n\n    this.isActivated = true\n    this.setVisibility(true)\n\n    // Enhanced activation effects\n    this.gateMesh.material.emissiveIntensity = 0.8\n    this.gateLight.intensity = 1.5\n\n    // Activate rim lights\n    this.rimLights.forEach(light => {\n      light.intensity = 0.4\n    })\n\n    console.log('âœ¨ Gate activated!')\n  }\n\n  /**\n   * Deactivate the gate\n   */\n  deactivate() {\n    this.isActivated = false\n    this.setVisibility(false)\n    this.gateMesh.material.emissiveIntensity = 0.5\n    this.gateLight.intensity = 1.0\n\n    // Deactivate rim lights\n    this.rimLights.forEach(light => {\n      light.intensity = 0.1\n    })\n  }\n\n  /**\n   * Set gate visibility\n   */\n  setVisibility(visible) {\n    if (visible) {\n      this.scene.add(this.gateMesh)\n      this.scene.add(this.portalMesh)\n      this.scene.add(this.gateLight)\n      // Add rim lights\n      this.rimLights.forEach(light => this.scene.add(light))\n    } else {\n      this.scene.remove(this.gateMesh)\n      this.scene.remove(this.portalMesh)\n      this.scene.remove(this.gateLight)\n      // Remove rim lights\n      this.rimLights.forEach(light => this.scene.remove(light))\n    }\n  }\n\n  /**\n   * Handle player collision with gate\n   */\n  onPlayerEnter() {\n    if (!this.isActivated || this.isCollected) {\n      return false\n    }\n\n    this.isCollected = true\n    console.log('ðŸŽ¯ Player entered gate - Level Complete!')\n\n    // Gate completion effects\n    this.gateMesh.material.emissiveIntensity = 1.0\n    this.gateLight.intensity = 2.0\n\n    return true\n  }\n\n  /**\n   * Update gate animations and effects\n   */\n  update(deltaTime) {\n    if (!this.isActivated) {\n      return\n    }\n\n    this.time += deltaTime\n\n    // Enhanced pulsing glow effect\n    const pulseIntensity =\n      0.4 + Math.sin(this.time * this.pulseSpeed * 10) * 0.3\n    this.gateMesh.material.emissiveIntensity = pulseIntensity\n    this.gateLight.intensity = 0.8 + pulseIntensity\n\n    // Gentle rotation\n    this.gateMesh.rotation.z += this.rotationSpeed\n\n    // Enhanced portal shimmer effect\n    this.portalMesh.material.opacity =\n      0.2 + Math.sin(this.time * this.pulseSpeed * 15) * 0.2\n\n    // Animate rim lights for dynamic lighting\n    this.rimLights.forEach((light, index) => {\n      const userData = light.userData\n      const animationTime = this.time * 0.5 + userData.animationOffset\n\n      // Create pulsing effect with phase offset for each light\n      const pulseFactor = 0.2 + Math.sin(animationTime + index * 0.5) * 0.2\n      light.intensity = pulseFactor\n\n      // Slight movement for dynamic effect\n      const lightRadius = this.width * 1.2\n      const wobble = Math.sin(animationTime * 2) * 0.1\n      light.position.set(\n        this.position.x +\n          Math.cos(userData.originalAngle) * (lightRadius + wobble),\n        this.position.y +\n          Math.sin(userData.originalAngle) * (lightRadius + wobble) * 0.7,\n        this.position.z + Math.sin(animationTime * 3) * 0.5\n      )\n    })\n  }\n\n  /**\n   * Get gate position\n   */\n  getPosition() {\n    return this.position.clone()\n  }\n\n  /**\n   * Check if gate is activated\n   */\n  getIsActivated() {\n    return this.isActivated\n  }\n\n  /**\n   * Check if gate has been collected (level completed)\n   */\n  getIsCollected() {\n    return this.isCollected\n  }\n\n  /**\n   * Reset gate for new level\n   */\n  reset() {\n    this.isCollected = false\n    this.deactivate()\n    this.time = 0\n  }\n\n  /**\n   * Dispose of gate resources\n   */\n  dispose() {\n    // Remove from physics engine - handle array of physics bodies\n    if (Array.isArray(this.physicsBody)) {\n      this.physicsBody.forEach(body => {\n        this.physicsEngine.removeRigidBody(body)\n      })\n    } else if (this.physicsBody) {\n      this.physicsEngine.removeRigidBody(this.physicsBody)\n    }\n\n    // Remove from scene\n    this.setVisibility(false)\n\n    // Dispose geometry and materials\n    if (this.gateMesh) {\n      this.gateMesh.geometry.dispose()\n      this.gateMesh.material.dispose()\n    }\n\n    if (this.portalMesh) {\n      this.portalMesh.geometry.dispose()\n      this.portalMesh.material.dispose()\n    }\n\n    console.log('ðŸ—‘ï¸ Gate disposed')\n  }\n}\n","/**\n * Star Geometry for Ocean Adventure\n *\n * Creates actual star-shaped geometry instead of simple spheres\n * for more realistic collectible stars.\n */\n\nimport * as THREE from 'three'\n\nexport class StarGeometry {\n  /**\n   * Create a 3D star shape with specified parameters\n   * @param {number} innerRadius - Inner radius of the star points\n   * @param {number} outerRadius - Outer radius of the star points\n   * @param {number} points - Number of star points (default: 5)\n   * @param {number} depth - Depth/thickness of the star (default: 0.1)\n   */\n  static create(innerRadius = 0.2, outerRadius = 0.4, points = 5, depth = 0.1) {\n    // Create star shape using Three.js Shape\n    const starShape = new THREE.Shape()\n\n    // Calculate star points\n    const angleStep = (Math.PI * 2) / points\n    const halfAngleStep = angleStep / 2\n\n    // Start at the top point\n    let angle = -Math.PI / 2 // Start at top\n    starShape.moveTo(\n      Math.cos(angle) * outerRadius,\n      Math.sin(angle) * outerRadius\n    )\n\n    // Create star points by alternating between outer and inner radius\n    for (let i = 0; i < points; i++) {\n      // Inner point\n      angle += halfAngleStep\n      starShape.lineTo(\n        Math.cos(angle) * innerRadius,\n        Math.sin(angle) * innerRadius\n      )\n\n      // Outer point\n      angle += halfAngleStep\n      starShape.lineTo(\n        Math.cos(angle) * outerRadius,\n        Math.sin(angle) * outerRadius\n      )\n    }\n\n    // Extrude the shape to create 3D star\n    const extrudeSettings = {\n      depth: depth,\n      bevelEnabled: true,\n      bevelSegments: 2,\n      steps: 2,\n      bevelSize: 0.02,\n      bevelThickness: 0.02,\n    }\n\n    const starGeometry = new THREE.ExtrudeGeometry(starShape, extrudeSettings)\n\n    // Center the geometry\n    starGeometry.center()\n\n    return starGeometry\n  }\n\n  /**\n   * Create a simple star material with enhanced glowing effects\n   * @param {number} color - Base color (default: gold)\n   * @param {number} emissiveIntensity - Glow intensity (default: 0.6)\n   */\n  static createMaterial(color = 0xffd700, emissiveIntensity = 0.6) {\n    return new THREE.MeshPhongMaterial({\n      color: color,\n      emissive: color,\n      emissiveIntensity: emissiveIntensity,\n      shininess: 100,\n      specular: 0xffffff,\n      transparent: true,\n      opacity: 0.95,\n    })\n  }\n\n  /**\n   * Create multiple star variants with different sizes and colors\n   */\n  static createVariants() {\n    const variants = []\n\n    // Different star sizes and colors\n    const configs = [\n      { inner: 0.15, outer: 0.35, color: 0xffd700 }, // Classic gold\n      { inner: 0.18, outer: 0.38, color: 0xffff80 }, // Light yellow\n      { inner: 0.12, outer: 0.32, color: 0xffa500 }, // Orange\n      { inner: 0.2, outer: 0.4, color: 0xfffacd }, // Light gold\n      { inner: 0.16, outer: 0.36, color: 0xffb347 }, // Sandy brown\n    ]\n\n    configs.forEach(config => {\n      const geometry = StarGeometry.create(config.inner, config.outer)\n      const material = StarGeometry.createMaterial(config.color)\n      variants.push({ geometry, material, config })\n    })\n\n    return variants\n  }\n}\n","/**\n * Ocean Adventure - Main Game Entry Point\n *\n * This is a placeholder implementation showing the basic structure\n * for the 3D underwater platform game. The actual game engine\n * implementation will be developed following the Copilot plan.\n */\n\nimport * as THREE from 'three'\nimport { PhysicsEngine } from './core/Physics.js'\nimport { ParticleSystem } from './core/ParticleSystem.js'\nimport { AudioEngine } from './core/AudioEngine.js'\nimport { Player } from './components/Player.js'\nimport { Gate } from './components/Gate.js'\nimport { StarGeometry } from './components/StarGeometry.js'\n\n// Game configuration\nconst CONFIG = {\n  targetFPS: 60,\n  mobileFPS: 30,\n  canvasId: 'gameCanvas',\n  loadingId: 'loading',\n  uiId: 'ui',\n}\n\nclass OceanAdventure {\n  constructor() {\n    this.scene = null\n    this.camera = null\n    this.renderer = null\n    this.canvas = null\n    this.isLoaded = false\n    this.isMobile = this.detectMobile()\n\n    // Core systems\n    this.physicsEngine = null\n    this.particleSystem = null\n    this.audioEngine = null\n    this.player = null\n    this.gate = null\n    this.environmentObjects = []\n\n    // Game state\n    this.starCount = 0\n    this.levelNumber = 1\n\n    // Input state\n    this.inputState = {\n      keys: {\n        forward: false,\n        backward: false,\n        left: false,\n        right: false,\n        up: false,\n        down: false,\n      },\n      joystick: { x: 0, y: 0 },\n      mobileButtons: { swimUp: false, swimDown: false },\n    }\n\n    // Timing\n    this.lastTime = 0\n\n    console.log('ðŸŒŠ Ocean Adventure - Initializing...')\n  }\n\n  async initialize() {\n    const steps = [\n      { name: 'Canvas Setup', fn: () => this.setupCanvas() },\n      { name: 'WebGL Renderer', fn: () => this.setupRenderer() },\n      { name: '3D Scene', fn: () => this.setupScene() },\n      { name: 'Camera', fn: () => this.setupCamera() },\n      { name: 'Lighting', fn: () => this.setupLights() },\n      { name: 'Physics Engine', fn: () => this.initializePhysics() },\n      { name: 'Particle System', fn: () => this.initializeParticleSystem() },\n      { name: 'Audio Engine', fn: () => this.initializeAudio() },\n      { name: 'Environment', fn: () => this.createUnderwaterEnvironment() },\n      { name: 'Player', fn: () => this.createPlayer() },\n      { name: 'Sample Stars', fn: () => this.createSampleStars() },\n      { name: 'Gate', fn: () => this.createGate() },\n      { name: 'Event Listeners', fn: () => this.setupEventListeners() },\n      {\n        name: 'UI Initialization',\n        fn: () => {\n          this.hideLoading()\n          this.showUI()\n        },\n      },\n      { name: 'Game Loop', fn: () => this.startGameLoop() },\n    ]\n\n    try {\n      console.log('ðŸŽ® Ocean Adventure - Starting initialization...')\n\n      for (let i = 0; i < steps.length; i++) {\n        const step = steps[i]\n        console.log(`[${i + 1}/${steps.length}] Initializing ${step.name}...`)\n\n        try {\n          await step.fn()\n          console.log(`âœ… ${step.name} initialized successfully`)\n        } catch (stepError) {\n          console.error(`âŒ Failed to initialize ${step.name}:`, stepError)\n          throw new Error(\n            `Initialization failed at step \"${step.name}\": ${stepError.message}`\n          )\n        }\n      }\n\n      this.isLoaded = true\n      console.log('ðŸŽ‰ Ocean Adventure - Ready to play!')\n    } catch (error) {\n      console.error('âŒ Failed to initialize game:', error)\n      this.showError('Failed to initialize game: ' + error.message)\n    }\n  }\n\n  setupCanvas() {\n    console.log('ðŸŽ® Setting up canvas...')\n    this.canvas = document.getElementById(CONFIG.canvasId)\n    if (!this.canvas) {\n      throw new Error('Game canvas not found')\n    }\n    console.log('âœ… Canvas found and configured')\n  }\n\n  setupRenderer() {\n    console.log('ðŸŽ¨ Setting up WebGL renderer...')\n    try {\n      this.renderer = new THREE.WebGLRenderer({\n        canvas: this.canvas,\n        antialias: !this.isMobile, // Disable antialiasing on mobile for performance\n        alpha: false,\n        powerPreference: this.isMobile ? 'low-power' : 'high-performance',\n        failIfMajorPerformanceCaveat: false, // Allow fallback rendering\n        preserveDrawingBuffer: false, // Better performance\n        premultipliedAlpha: false,\n        stencil: false, // Reduce memory usage\n      })\n\n      this.renderer.setSize(window.innerWidth, window.innerHeight)\n      this.renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2))\n      this.renderer.setClearColor(0x001830, 1) // Darker, more contrasting ocean blue\n\n      // Enable shadows with mobile-optimized settings\n      this.renderer.shadowMap.enabled = true\n      this.renderer.shadowMap.type = this.isMobile\n        ? THREE.BasicShadowMap // Faster shadow type for mobile\n        : THREE.PCFSoftShadowMap // Better quality for desktop\n\n      // Enhanced WebGL settings for modern lighting\n      this.renderer.outputColorSpace = THREE.SRGBColorSpace\n      this.renderer.toneMapping = THREE.ACESFilmicToneMapping\n      this.renderer.toneMappingExposure = 1.0\n\n      // Validate WebGL context\n      const gl = this.renderer.getContext()\n      if (!gl) {\n        throw new Error('Failed to get WebGL context')\n      }\n\n      // Add error handling for WebGL\n      gl.getExtension('WEBGL_lose_context')\n\n      console.log('âœ… WebGL renderer configured successfully')\n    } catch (error) {\n      console.error('âŒ Failed to setup WebGL renderer:', error)\n      throw new Error(`WebGL initialization failed: ${error.message}`)\n    }\n  }\n\n  setupScene() {\n    console.log('ðŸŒŠ Setting up 3D scene...')\n    this.scene = new THREE.Scene()\n    console.log('âœ… 3D scene created successfully')\n  }\n\n  /**\n   * Initialize physics engine\n   */\n  initializePhysics() {\n    this.physicsEngine = new PhysicsEngine()\n    console.log('âš¡ Physics engine initialized')\n  }\n\n  /**\n   * Initialize particle system\n   */\n  initializeParticleSystem() {\n    this.particleSystem = new ParticleSystem(this.scene, 500) // Reduced for mobile performance\n    console.log('âœ¨ Particle system initialized')\n  }\n\n  /**\n   * Initialize audio engine\n   */\n  initializeAudio() {\n    this.audioEngine = new AudioEngine()\n    // Note: Audio will be initialized on first user interaction due to browser policies\n    console.log('ðŸ”Š Audio engine created (will initialize on user interaction)')\n  }\n\n  /**\n   * Try to initialize audio on first user interaction\n   */\n  async tryInitializeAudio() {\n    if (this.audioEngine && !this.audioEngine.isInitialized) {\n      try {\n        await this.audioEngine.initialize()\n        this.audioEngine.startAmbientSound()\n        console.log('ðŸŒŠ Audio initialized and ambient sound started')\n      } catch (error) {\n        console.warn('Audio initialization failed:', error)\n      }\n    }\n  }\n\n  setupCamera() {\n    this.camera = new THREE.PerspectiveCamera(\n      75, // Field of view\n      window.innerWidth / window.innerHeight, // Aspect ratio\n      0.1, // Near clipping plane\n      2000 // Far clipping plane to see sky elements\n    )\n\n    // Position camera to view deep underwater level while still seeing water surface\n    this.camera.position.set(0, 5, 15) // Adjusted for deeper level - closer to water surface\n    this.camera.lookAt(0, -5, 0) // Look down towards the deeper player area\n  }\n\n  setupLights() {\n    // Enhanced underwater ambient lighting (adjusted for modern lighting model)\n    const ambientLight = new THREE.AmbientLight(0x336699, 0.3) // Reduced from 0.6\n    this.scene.add(ambientLight)\n\n    // Primary directional light simulating filtered sunlight from above (adjusted intensity)\n    const directionalLight = new THREE.DirectionalLight(0x87ceeb, 2.5) // Increased from 1.2\n    directionalLight.position.set(0, 50, 10)\n\n    // Enable shadows with optimized settings for mobile compatibility\n    if (this.renderer.shadowMap.enabled) {\n      directionalLight.castShadow = true\n      // Use smaller shadow map sizes on mobile for better performance\n      const shadowMapSize = this.isMobile ? 512 : 1024\n      directionalLight.shadow.mapSize.width = shadowMapSize\n      directionalLight.shadow.mapSize.height = shadowMapSize\n      directionalLight.shadow.camera.near = 0.5\n      directionalLight.shadow.camera.far = 500\n      directionalLight.shadow.camera.left = -50\n      directionalLight.shadow.camera.right = 50\n      directionalLight.shadow.camera.top = 50\n      directionalLight.shadow.camera.bottom = -50\n      // Use less expensive shadow map type on mobile\n      if (this.isMobile) {\n        directionalLight.shadow.bias = -0.0005\n      }\n    }\n\n    this.scene.add(directionalLight)\n\n    // Add volumetric underwater lighting with point lights for better WebGL effects\n    this.addUnderwaterVolumetricLights()\n\n    // Add subtle rim lighting to enhance object definition (adjusted intensity)\n    const rimLight = new THREE.DirectionalLight(0x4a9eff, 0.8) // Increased from 0.4\n    rimLight.position.set(-20, 10, -20)\n    this.scene.add(rimLight)\n\n    // Create background skybox with gradient and clouds\n    this.createSkybox()\n  }\n\n  /**\n   * Create a simple skybox with gradient and cloud effects\n   */\n  createSkybox() {\n    const skyGeometry = new THREE.SphereGeometry(1500, 32, 32) // Much larger sphere\n\n    // Use high contrast visible material\n    const skyMaterial = new THREE.MeshBasicMaterial({\n      color: 0x87ceeb, // Light sky blue\n      side: THREE.BackSide,\n      transparent: false,\n      fog: false,\n    })\n\n    const skyMesh = new THREE.Mesh(skyGeometry, skyMaterial)\n    skyMesh.position.set(0, 0, 0) // Ensure centered\n    this.scene.add(skyMesh)\n\n    // Add some simple cloud sprites\n    this.createClouds()\n\n    console.log('â˜ï¸ Skybox created')\n  }\n\n  /**\n   * Create simple cloud sprites\n   */\n  createClouds() {\n    const cloudGeometry = new THREE.SphereGeometry(15, 8, 8) // Larger clouds\n    const cloudMaterial = new THREE.MeshBasicMaterial({\n      color: 0xffffff,\n      transparent: true,\n      opacity: 1.0, // Full opacity for maximum visibility\n    })\n\n    this.clouds = []\n    for (let i = 0; i < 8; i++) {\n      const cloud = new THREE.Mesh(cloudGeometry, cloudMaterial.clone())\n\n      // Position clouds much closer and at moderate height\n      const angle = (i / 8) * Math.PI * 2\n      const radius = 80 + Math.random() * 40 // Closer to camera\n      cloud.position.set(\n        Math.cos(angle) * radius,\n        30 + Math.random() * 15, // Lower height for visibility\n        Math.sin(angle) * radius\n      )\n\n      // Larger scale\n      const scale = 2.0 + Math.random() * 1.0\n      cloud.scale.setScalar(scale)\n\n      // Store animation data\n      cloud.userData = {\n        originalPosition: cloud.position.clone(),\n        speed: 0.02 + Math.random() * 0.02,\n        offset: Math.random() * Math.PI * 2,\n      }\n\n      this.clouds.push(cloud)\n      this.scene.add(cloud)\n    }\n  }\n\n  addUnderwaterVolumetricLights() {\n    // Create multiple point lights for underwater caustics effect\n    const lightColors = [0x4a9eff, 0x87ceeb, 0x6495ed, 0x00bfff]\n    const lightCount = this.isMobile ? 3 : 5 // Fewer lights on mobile\n\n    for (let i = 0; i < lightCount; i++) {\n      const pointLight = new THREE.PointLight(\n        lightColors[i % lightColors.length],\n        this.isMobile ? 2.0 : 3.0, // Adjusted for modern lighting model\n        30, // Distance\n        2 // Decay\n      )\n\n      // Position lights in a scattered pattern above the scene\n      const angle = (i / lightCount) * Math.PI * 2\n      const radius = 15 + Math.random() * 10\n      pointLight.position.set(\n        Math.cos(angle) * radius,\n        8 + Math.random() * 5, // Varying heights\n        Math.sin(angle) * radius\n      )\n\n      // Store animation properties\n      pointLight.userData = {\n        originalPosition: pointLight.position.clone(),\n        animationOffset: Math.random() * Math.PI * 2,\n        animationSpeed: 0.5 + Math.random() * 0.5,\n        animationRadius: 2 + Math.random() * 3,\n      }\n\n      this.scene.add(pointLight)\n\n      // Store reference for animation\n      if (!this.volumetricLights) {\n        this.volumetricLights = []\n      }\n      this.volumetricLights.push(pointLight)\n    }\n  }\n\n  /**\n   * Create sun or moon based on level number\n   */\n  createCelestialBody() {\n    const isEvenLevel = this.levelNumber % 2 === 0\n\n    if (isEvenLevel) {\n      // Create sun\n      const sunGeometry = new THREE.SphereGeometry(8, 32, 32) // Larger and more visible\n      const sunMaterial = new THREE.MeshBasicMaterial({\n        color: 0xffdd44,\n        transparent: false,\n      })\n      this.celestialBody = new THREE.Mesh(sunGeometry, sunMaterial)\n\n      // Position sun closer for better visibility\n      this.celestialBody.position.set(50, 40, -40)\n\n      // Add sun light\n      this.celestialLight = new THREE.DirectionalLight(0xffffff, 1.5)\n      this.celestialLight.position.copy(this.celestialBody.position)\n      this.celestialLight.target.position.set(0, 5, 0) // Point at water surface\n\n      console.log('â˜€ï¸ Sun created for even level', this.levelNumber)\n    } else {\n      // Create moon\n      const moonGeometry = new THREE.SphereGeometry(6, 32, 32) // Larger and more visible\n      const moonMaterial = new THREE.MeshBasicMaterial({\n        color: 0xccccdd,\n        transparent: false,\n      })\n      this.celestialBody = new THREE.Mesh(moonGeometry, moonMaterial)\n\n      // Position moon closer for better visibility\n      this.celestialBody.position.set(-45, 35, -35)\n\n      // Add moon light (dimmer)\n      this.celestialLight = new THREE.DirectionalLight(0x9999bb, 0.8)\n      this.celestialLight.position.copy(this.celestialBody.position)\n      this.celestialLight.target.position.set(0, 5, 0) // Point at water surface\n\n      console.log('ðŸŒ™ Moon created for odd level', this.levelNumber)\n    }\n\n    // Store initial position for animation\n    this.celestialBody.userData = {\n      originalPosition: this.celestialBody.position.clone(),\n      isEvenLevel: isEvenLevel,\n      animationRadius: 15, // Reduced for closer visibility\n      animationSpeed: 0.2,\n    }\n\n    this.scene.add(this.celestialBody)\n    this.scene.add(this.celestialLight)\n    this.scene.add(this.celestialLight.target)\n  }\n\n  /**\n   * Initialize underwater atmosphere effects (fog, blue tinting)\n   */\n  initializeUnderwaterAtmosphere() {\n    // Initialize fog settings for underwater effect\n    this.underwaterFog = {\n      enabled: false,\n      color: new THREE.Color(0x006699), // Deep blue underwater color\n      near: 5,\n      far: 40,\n    }\n\n    // Store original scene background for surface mode\n    this.originalSceneBackground = this.scene.background\n    this.originalClearColor = this.renderer.getClearColor(new THREE.Color())\n\n    // Track whether player is underwater\n    this.isUnderwater = false\n\n    console.log('ðŸŒŠ Underwater atmosphere system initialized')\n  }\n\n  /**\n   * Update underwater atmosphere effects based on camera position\n   */\n  updateUnderwaterAtmosphere() {\n    const cameraY = this.camera.position.y\n    const waterSurfaceLevel = 5.0\n    const wasUnderwater = this.isUnderwater\n    this.isUnderwater = cameraY < waterSurfaceLevel\n\n    // If underwater state changed, update atmosphere\n    if (this.isUnderwater !== wasUnderwater) {\n      if (this.isUnderwater) {\n        // Entering underwater - apply blue fog and tinting\n        this.scene.fog = new THREE.Fog(\n          this.underwaterFog.color,\n          this.underwaterFog.near,\n          this.underwaterFog.far\n        )\n\n        // Change renderer clear color to underwater blue\n        this.renderer.setClearColor(0x004466, 1)\n\n        // Add blue tint to skybox when underwater\n        if (this.scene.children) {\n          this.scene.children.forEach(child => {\n            if (\n              child.material &&\n              child.material.color &&\n              child.geometry &&\n              child.geometry.type === 'SphereGeometry'\n            ) {\n              // This is likely the skybox\n              child.material.color.setHex(0x004466)\n            }\n          })\n        }\n\n        console.log('ðŸŒŠ Entered underwater - fog and blue tinting applied')\n      } else {\n        // Exiting underwater - remove fog effects\n        this.scene.fog = null\n\n        // Restore original clear color\n        this.renderer.setClearColor(this.originalClearColor, 1)\n\n        // Restore skybox color\n        if (this.scene.children) {\n          this.scene.children.forEach(child => {\n            if (\n              child.material &&\n              child.material.color &&\n              child.geometry &&\n              child.geometry.type === 'SphereGeometry'\n            ) {\n              // This is likely the skybox\n              child.material.color.setHex(0x87ceeb) // Light sky blue\n            }\n          })\n        }\n\n        console.log('ðŸŒŠ Exited underwater - fog removed')\n      }\n    }\n\n    // Gradual fog density adjustment based on depth underwater\n    if (this.isUnderwater && this.scene.fog) {\n      const depth = Math.max(0, waterSurfaceLevel - cameraY)\n      const maxDepth = 15 // Maximum depth for fog calculations\n      const fogIntensity = Math.min(1, depth / maxDepth)\n\n      // Adjust fog far distance based on depth\n      this.scene.fog.far = this.underwaterFog.far * (1 - fogIntensity * 0.6)\n\n      // Make fog more intense at deeper levels\n      const deepBlue = new THREE.Color(0x003355)\n      this.scene.fog.color.lerpColors(\n        this.underwaterFog.color,\n        deepBlue,\n        fogIntensity * 0.5\n      )\n    }\n  }\n\n  createUnderwaterEnvironment() {\n    // Create animated water surface at Y=5 (matches depth meter calculation)\n    const waterSurfaceGeometry = new THREE.PlaneGeometry(400, 400, 128, 128) // Higher resolution for better wave detail\n\n    // Enhanced water material with improved visual effects\n    const waterSurfaceMaterial = new THREE.MeshPhongMaterial({\n      color: 0x0099ff, // Bright blue for excellent wave visibility\n      transparent: true,\n      opacity: 0.8, // Higher opacity to see the surface better\n      side: THREE.DoubleSide, // Visible from both sides\n      shininess: 200, // Maximum shininess for better light reflection\n      specular: 0xffffff, // White specular highlights for brightness\n      depthWrite: false, // Disable depth writing for better transparency\n      reflectivity: 1.0, // Maximum reflectivity\n      emissive: 0x001122, // Slight blue emissive glow\n    })\n\n    const waterSurface = new THREE.Mesh(\n      waterSurfaceGeometry,\n      waterSurfaceMaterial\n    )\n    waterSurface.rotation.x = -Math.PI / 2 // Horizontal surface\n    waterSurface.position.y = 5 // Water surface level used by depth meter\n    waterSurface.receiveShadow = true\n    waterSurface.castShadow = false\n    this.scene.add(waterSurface)\n\n    // CRITICAL FIX: Add highly visible wireframe version that MUST show waves\n    const wireframeMaterial = new THREE.MeshBasicMaterial({\n      color: 0xff0000, // BRIGHT RED for absolute visibility\n      wireframe: true,\n      opacity: 1.0, // Full opacity\n      transparent: false,\n    })\n    const wireframeWater = new THREE.Mesh(\n      new THREE.PlaneGeometry(400, 400, 32, 32), // Lower resolution for clearer wireframe\n      wireframeMaterial\n    )\n    wireframeWater.rotation.x = -Math.PI / 2\n    wireframeWater.position.y = 4 // Just below water surface for underwater visibility\n    this.scene.add(wireframeWater)\n\n    // Add second wireframe that matches the actual water surface for comparison\n    const surfaceWireframeMaterial = new THREE.MeshBasicMaterial({\n      color: 0x00ff00, // BRIGHT GREEN for comparison\n      wireframe: true,\n      opacity: 0.8,\n      transparent: true,\n    })\n    const surfaceWireframeWater = new THREE.Mesh(\n      new THREE.PlaneGeometry(400, 400, 128, 128), // Same resolution as water surface\n      surfaceWireframeMaterial\n    )\n    surfaceWireframeWater.rotation.x = -Math.PI / 2\n    surfaceWireframeWater.position.y = 5.1 // Just above water surface\n    this.scene.add(surfaceWireframeWater)\n\n    // Store references for wave animation\n    this.wireframeWater = wireframeWater\n    this.surfaceWireframeWater = surfaceWireframeWater\n    this.waterSurface = waterSurface\n\n    // SIMPLIFIED but GUARANTEED VISIBLE wave parameters\n    this.waveParams = {\n      amplitude: 15.0, // EXTREME amplitude - must be visible\n      frequency: 0.05,\n      speed: 1.0,\n    }\n\n    // Store original vertex positions for wave animation\n    const positions = waterSurface.geometry.attributes.position.array\n    this.waterOriginalPositions = new Float32Array(positions.length)\n    for (let i = 0; i < positions.length; i++) {\n      this.waterOriginalPositions[i] = positions[i]\n    }\n\n    // Store wireframe original positions\n    const wirePositions = wireframeWater.geometry.attributes.position.array\n    this.wireframeOriginalPositions = new Float32Array(wirePositions.length)\n    for (let i = 0; i < wirePositions.length; i++) {\n      this.wireframeOriginalPositions[i] = wirePositions[i]\n    }\n\n    // Store surface wireframe original positions\n    const surfaceWirePositions =\n      surfaceWireframeWater.geometry.attributes.position.array\n    this.surfaceWireframeOriginalPositions = new Float32Array(\n      surfaceWirePositions.length\n    )\n    for (let i = 0; i < surfaceWirePositions.length; i++) {\n      this.surfaceWireframeOriginalPositions[i] = surfaceWirePositions[i]\n    }\n\n    // Add foam/whitecap effect for wave crests\n    const foamGeometry = new THREE.PlaneGeometry(400, 400, 64, 64)\n    const foamMaterial = new THREE.MeshBasicMaterial({\n      color: 0xffffff, // White foam\n      transparent: true,\n      opacity: 0.6, // Higher opacity for better visibility\n      side: THREE.DoubleSide,\n      alphaTest: 0.05, // Lower alpha test for better blending\n      depthWrite: false, // Don't write to depth buffer for proper blending\n      blending: THREE.AdditiveBlending, // Additive blending for brighter foam\n    })\n\n    const foamSurface = new THREE.Mesh(foamGeometry, foamMaterial)\n    foamSurface.rotation.x = -Math.PI / 2\n    foamSurface.position.y = 5.2 // Slightly above water surface\n    this.scene.add(foamSurface)\n\n    // Store references for animation\n    this.foamSurface = foamSurface\n    this.foamOriginalPositions = new Float32Array(\n      foamGeometry.attributes.position.array\n    )\n\n    // Initialize underwater atmosphere system\n    this.initializeUnderwaterAtmosphere()\n\n    // Create sun or moon based on level number (even = sun, odd = moon)\n    this.createCelestialBody()\n\n    // Create ocean floor with enhanced material - positioned deeper for level layout\n    const floorGeometry = new THREE.PlaneGeometry(100, 100)\n    const floorMaterial = new THREE.MeshPhongMaterial({\n      color: 0x8b4513,\n      shininess: 30,\n      specular: 0x222222,\n    })\n    const floor = new THREE.Mesh(floorGeometry, floorMaterial)\n    floor.rotation.x = -Math.PI / 2\n    floor.position.y = -15 // Moved 10 units deeper from -5 to -15\n    floor.receiveShadow = true\n    this.scene.add(floor)\n\n    // Create physics body for floor\n    const floorPhysicsBody = this.physicsEngine.createBoxBody(\n      new THREE.Vector3(0, -15, 0), // Updated to match new floor position\n      new THREE.Vector3(100, 0.1, 100),\n      true // Static\n    )\n    floorPhysicsBody.type = 'environment'\n    this.physicsEngine.addRigidBody(floorPhysicsBody)\n\n    // Add invisible boundary walls to prevent falling off the platform\n    this.createLevelBoundaries()\n\n    // Add coral/rocks with enhanced materials and lighting\n    for (let i = 0; i < 10; i++) {\n      const radius = 0.5 + Math.random() * 1.5\n      const geometry = new THREE.SphereGeometry(radius)\n\n      // Use MeshPhongMaterial for better lighting on all platforms\n      const hue = Math.random() * 0.3\n      const material = new THREE.MeshPhongMaterial({\n        color: new THREE.Color().setHSL(hue, 0.7, 0.5),\n        shininess: 60 + Math.random() * 40,\n        specular: new THREE.Color().setHSL(hue, 0.3, 0.8),\n        // Add slight transparency for underwater effect\n        transparent: true,\n        opacity: 0.9,\n      })\n\n      const coral = new THREE.Mesh(geometry, material)\n\n      const position = new THREE.Vector3(\n        (Math.random() - 0.5) * 80,\n        -14 + Math.random() * 2, // Moved 10 units deeper: was -4 to -2, now -14 to -12\n        (Math.random() - 0.5) * 80\n      )\n      coral.position.copy(position)\n      coral.castShadow = true\n      coral.receiveShadow = true\n      this.scene.add(coral)\n\n      // Add physics body for collision\n      const coralPhysicsBody = this.physicsEngine.createSphereBody(\n        position,\n        radius * 1.2, // Slightly larger for collision detection\n        true // Static\n      )\n      coralPhysicsBody.type = 'environment'\n      coralPhysicsBody.mesh = coral // Reference to visual representation\n      this.physicsEngine.addRigidBody(coralPhysicsBody)\n      this.environmentObjects.push({\n        mesh: coral,\n        physicsBody: coralPhysicsBody,\n      })\n    }\n  }\n\n  /**\n   * Create invisible boundary walls around the level\n   */\n  createLevelBoundaries() {\n    console.log('ðŸ§± Creating level boundaries...')\n\n    // Level size should match the floor size (100x100)\n    const levelSize = 50 // Half the floor size (radius from center)\n    const wallHeight = 15 // Height of boundary walls\n    const wallThickness = 2 // Thickness of walls\n\n    // Create four walls around the level perimeter - positioned for deeper level\n    const wallConfigs = [\n      // North wall (positive Z)\n      {\n        position: new THREE.Vector3(0, wallHeight / 2 - 10, levelSize), // Moved 10 units deeper\n        size: new THREE.Vector3(levelSize * 2, wallHeight, wallThickness),\n        name: 'North Wall',\n      },\n      // South wall (negative Z)\n      {\n        position: new THREE.Vector3(0, wallHeight / 2 - 10, -levelSize), // Moved 10 units deeper\n        size: new THREE.Vector3(levelSize * 2, wallHeight, wallThickness),\n        name: 'South Wall',\n      },\n      // East wall (positive X)\n      {\n        position: new THREE.Vector3(levelSize, wallHeight / 2 - 10, 0), // Moved 10 units deeper\n        size: new THREE.Vector3(wallThickness, wallHeight, levelSize * 2),\n        name: 'East Wall',\n      },\n      // West wall (negative X)\n      {\n        position: new THREE.Vector3(-levelSize, wallHeight / 2 - 10, 0), // Moved 10 units deeper\n        size: new THREE.Vector3(wallThickness, wallHeight, levelSize * 2),\n        name: 'West Wall',\n      },\n    ]\n\n    wallConfigs.forEach(config => {\n      // Create invisible physics wall (no visual mesh needed)\n      const wallPhysicsBody = this.physicsEngine.createBoxBody(\n        config.position,\n        config.size,\n        true // Static\n      )\n      wallPhysicsBody.type = 'environment'\n      wallPhysicsBody.name = config.name\n      this.physicsEngine.addRigidBody(wallPhysicsBody)\n\n      console.log(\n        `ðŸ§± Created ${config.name} at position (${config.position.x.toFixed(1)}, ${config.position.y.toFixed(1)}, ${config.position.z.toFixed(1)})`\n      )\n    })\n\n    console.log('âœ… Level boundaries created successfully')\n  }\n\n  createPlayer() {\n    // Create enhanced player with physics\n    this.player = new Player(this.scene, this.physicsEngine)\n    console.log('ðŸŠ Player created with physics')\n  }\n\n  /**\n   * Create the level completion gate\n   */\n  createGate() {\n    // Position gate deep underwater for blue atmosphere experience\n    const gatePosition = new THREE.Vector3(0, -8, -15) // 13m underwater to match player depth\n    this.gate = new Gate(this.scene, this.physicsEngine, gatePosition)\n    console.log(\n      `ðŸšª Gate created at position: (${gatePosition.x}, ${gatePosition.y}, ${gatePosition.z})`\n    )\n  }\n\n  createSampleStars() {\n    this.stars = []\n\n    // Create star geometry variants for visual variety\n    const starVariants = StarGeometry.createVariants()\n\n    // Create actual star-shaped collectibles with enhanced materials\n    for (let i = 0; i < 5; i++) {\n      // Use a random star variant for variety\n      const variant = starVariants[i % starVariants.length]\n      const starGeometry = variant.geometry.clone()\n      const starMaterial = variant.material.clone()\n\n      const star = new THREE.Mesh(starGeometry, starMaterial)\n      const position = new THREE.Vector3(\n        (Math.random() - 0.5) * 20,\n        Math.random() * 8 - 12, // Moved 10 units deeper: was -2 to +6, now -12 to -4\n        (Math.random() - 0.5) * 20\n      )\n      star.position.copy(position)\n      star.castShadow = true\n\n      // Add physics body for collision detection\n      const starPhysicsBody = this.physicsEngine.createSphereBody(\n        position,\n        1.0, // Increased from 0.5 to 1.0 for easier collection\n        true // Static - stars don't move\n      )\n      starPhysicsBody.type = 'collectible'\n      starPhysicsBody.mesh = star\n      starPhysicsBody.collected = false\n      this.physicsEngine.addRigidBody(starPhysicsBody)\n\n      // Add enhanced rotation animation and floating effect\n      star.userData = {\n        rotationSpeed: 0.02 + Math.random() * 0.02,\n        floatSpeed: 0.01 + Math.random() * 0.01,\n        floatOffset: Math.random() * Math.PI * 2,\n        originalY: position.y,\n        physicsBody: starPhysicsBody,\n        rotationAxis: new THREE.Vector3(\n          Math.random() - 0.5,\n          Math.random() - 0.5,\n          Math.random() - 0.5\n        ).normalize(),\n      }\n\n      this.stars.push({ mesh: star, physicsBody: starPhysicsBody })\n      this.scene.add(star)\n    }\n\n    console.log(`âœ¨ Created ${this.stars.length} sample stars`)\n  }\n\n  setupEventListeners() {\n    // Handle window resize\n    window.addEventListener('resize', () => this.onWindowResize(), {\n      passive: true,\n    })\n\n    // Enhanced input handling\n    window.addEventListener('keydown', event => this.onKeyDown(event))\n    window.addEventListener('keyup', event => this.onKeyUp(event))\n\n    // Touch controls for mobile\n    if (this.isMobile) {\n      this.setupTouchControls()\n    }\n\n    // Settings modal functionality\n    this.setupSettingsModal()\n  }\n\n  onKeyDown(event) {\n    // Initialize audio on first user interaction\n    this.tryInitializeAudio()\n\n    switch (event.code) {\n      case 'ArrowUp':\n      case 'KeyW':\n        this.inputState.keys.forward = true\n        break\n      case 'ArrowDown':\n      case 'KeyS':\n        this.inputState.keys.backward = true\n        break\n      case 'ArrowLeft':\n      case 'KeyA':\n        this.inputState.keys.left = true\n        break\n      case 'ArrowRight':\n      case 'KeyD':\n        this.inputState.keys.right = true\n        break\n      case 'Space':\n        this.inputState.keys.up = true\n        event.preventDefault()\n        break\n      case 'ShiftLeft':\n        this.inputState.keys.down = true\n        break\n    }\n  }\n\n  onKeyUp(event) {\n    switch (event.code) {\n      case 'ArrowUp':\n      case 'KeyW':\n        this.inputState.keys.forward = false\n        break\n      case 'ArrowDown':\n      case 'KeyS':\n        this.inputState.keys.backward = false\n        break\n      case 'ArrowLeft':\n      case 'KeyA':\n        this.inputState.keys.left = false\n        break\n      case 'ArrowRight':\n      case 'KeyD':\n        this.inputState.keys.right = false\n        break\n      case 'Space':\n        this.inputState.keys.up = false\n        break\n      case 'ShiftLeft':\n        this.inputState.keys.down = false\n        break\n    }\n  }\n\n  setupTouchControls() {\n    // Setup virtual joystick\n    this.setupVirtualJoystick()\n\n    // Setup mobile action buttons\n    this.setupMobileButtons()\n\n    // Touch control state for general canvas interactions\n    this.touchState = {\n      startX: 0,\n      startY: 0,\n      currentX: 0,\n      currentY: 0,\n      isActive: false,\n    }\n\n    // General canvas touch events (for swipe gestures)\n    this.canvas.addEventListener('touchstart', event => {\n      event.preventDefault()\n\n      // Initialize audio on first touch\n      this.tryInitializeAudio()\n\n      if (event.touches.length > 0) {\n        const touch = event.touches[0]\n        this.touchState.startX = touch.clientX\n        this.touchState.startY = touch.clientY\n        this.touchState.currentX = touch.clientX\n        this.touchState.currentY = touch.clientY\n        this.touchState.isActive = true\n      }\n    })\n\n    this.canvas.addEventListener('touchmove', event => {\n      event.preventDefault()\n      if (event.touches.length > 0 && this.touchState.isActive) {\n        const touch = event.touches[0]\n        this.touchState.currentX = touch.clientX\n        this.touchState.currentY = touch.clientY\n\n        // Calculate movement delta for swipe gestures\n        const deltaX = this.touchState.currentX - this.touchState.startX\n        const deltaY = this.touchState.currentY - this.touchState.startY\n\n        // Apply gentle swipe-based movement (subtle effect)\n        const moveSpeed = 0.05\n        const sensitivity = 3\n\n        if (Math.abs(deltaX) > 20) {\n          this.player.position.x += (deltaX / sensitivity) * moveSpeed * 0.01\n        }\n\n        if (Math.abs(deltaY) > 20) {\n          this.player.position.z += (deltaY / sensitivity) * moveSpeed * 0.01\n        }\n\n        this.updateCamera()\n      }\n    })\n\n    this.canvas.addEventListener('touchend', event => {\n      event.preventDefault()\n      this.touchState.isActive = false\n    })\n\n    this.canvas.addEventListener('touchcancel', event => {\n      event.preventDefault()\n      this.touchState.isActive = false\n    })\n  }\n\n  setupVirtualJoystick() {\n    const joystick = document.getElementById('virtualJoystick')\n    const knob = document.getElementById('joystickKnob')\n\n    if (!joystick || !knob) {\n      return\n    }\n\n    const joystickState = {\n      isActive: false,\n      centerX: 0,\n      centerY: 0,\n      currentX: 0,\n      currentY: 0,\n    }\n\n    joystick.addEventListener('touchstart', event => {\n      event.preventDefault()\n      event.stopPropagation()\n\n      if (event.touches.length > 0) {\n        const touch = event.touches[0]\n        const rect = joystick.getBoundingClientRect()\n\n        joystickState.isActive = true\n        joystickState.centerX = rect.left + rect.width / 2\n        joystickState.centerY = rect.top + rect.height / 2\n        joystickState.currentX = touch.clientX\n        joystickState.currentY = touch.clientY\n\n        // Visual feedback - highlight joystick when active\n        joystick.style.borderColor = 'rgba(255, 255, 255, 0.6)'\n        joystick.style.background = 'rgba(0, 17, 34, 0.7)'\n\n        this.updateJoystickKnob(knob, joystickState, rect)\n      }\n    })\n\n    joystick.addEventListener('touchmove', event => {\n      event.preventDefault()\n      event.stopPropagation()\n\n      if (event.touches.length > 0 && joystickState.isActive) {\n        const touch = event.touches[0]\n        const rect = joystick.getBoundingClientRect()\n\n        joystickState.currentX = touch.clientX\n        joystickState.currentY = touch.clientY\n\n        // Calculate movement vector\n        const deltaX = joystickState.currentX - joystickState.centerX\n        const deltaY = joystickState.currentY - joystickState.centerY\n        const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY)\n        const maxDistance = rect.width / 2 - 20\n\n        // Normalize and apply movement\n        if (distance > 5) {\n          const normalizedX = deltaX / maxDistance\n          const normalizedY = deltaY / maxDistance\n\n          // Update input state with improved sensitivity for mobile\n          this.inputState.joystick.x = Math.max(\n            -1,\n            Math.min(1, normalizedX * 1.2)\n          )\n          this.inputState.joystick.y = Math.max(\n            -1,\n            Math.min(1, normalizedY * 1.2)\n          )\n        } else {\n          this.inputState.joystick.x = 0\n          this.inputState.joystick.y = 0\n        }\n\n        this.updateJoystickKnob(knob, joystickState, rect)\n      }\n    })\n\n    joystick.addEventListener('touchend', event => {\n      event.preventDefault()\n      event.stopPropagation()\n\n      joystickState.isActive = false\n      this.inputState.joystick.x = 0\n      this.inputState.joystick.y = 0\n\n      // Reset visual feedback\n      joystick.style.borderColor = 'rgba(255, 255, 255, 0.3)'\n      joystick.style.background = 'rgba(0, 17, 34, 0.5)'\n      knob.style.transform = 'translate(-50%, -50%)'\n    })\n\n    joystick.addEventListener('touchcancel', event => {\n      event.preventDefault()\n      event.stopPropagation()\n\n      joystickState.isActive = false\n      this.inputState.joystick.x = 0\n      this.inputState.joystick.y = 0\n\n      // Reset visual feedback\n      joystick.style.borderColor = 'rgba(255, 255, 255, 0.3)'\n      joystick.style.background = 'rgba(0, 17, 34, 0.5)'\n      knob.style.transform = 'translate(-50%, -50%)'\n    })\n  }\n\n  updateJoystickKnob(knob, joystickState, rect) {\n    const deltaX = joystickState.currentX - joystickState.centerX\n    const deltaY = joystickState.currentY - joystickState.centerY\n    const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY)\n    const maxDistance = rect.width / 2 - 20\n\n    if (distance <= maxDistance) {\n      knob.style.transform = `translate(calc(-50% + ${deltaX}px), calc(-50% + ${deltaY}px))`\n    } else {\n      const angle = Math.atan2(deltaY, deltaX)\n      const x = Math.cos(angle) * maxDistance\n      const y = Math.sin(angle) * maxDistance\n      knob.style.transform = `translate(calc(-50% + ${x}px), calc(-50% + ${y}px))`\n    }\n  }\n\n  setupMobileButtons() {\n    const swimUpBtn = document.getElementById('swimUpBtn')\n    const swimDownBtn = document.getElementById('swimDownBtn')\n\n    if (swimUpBtn) {\n      // Add more responsive event handling\n      swimUpBtn.addEventListener('touchstart', event => {\n        event.preventDefault()\n        event.stopPropagation()\n        this.inputState.mobileButtons.swimUp = true\n        swimUpBtn.style.background = 'rgba(255, 255, 255, 0.4)'\n      })\n\n      swimUpBtn.addEventListener('touchend', event => {\n        event.preventDefault()\n        event.stopPropagation()\n        this.inputState.mobileButtons.swimUp = false\n        swimUpBtn.style.background = 'rgba(0, 17, 34, 0.6)'\n      })\n\n      swimUpBtn.addEventListener('touchcancel', event => {\n        event.preventDefault()\n        event.stopPropagation()\n        this.inputState.mobileButtons.swimUp = false\n        swimUpBtn.style.background = 'rgba(0, 17, 34, 0.6)'\n      })\n    }\n\n    if (swimDownBtn) {\n      // Add more responsive event handling\n      swimDownBtn.addEventListener('touchstart', event => {\n        event.preventDefault()\n        event.stopPropagation()\n        this.inputState.mobileButtons.swimDown = true\n        swimDownBtn.style.background = 'rgba(255, 255, 255, 0.4)'\n      })\n\n      swimDownBtn.addEventListener('touchend', event => {\n        event.preventDefault()\n        event.stopPropagation()\n        this.inputState.mobileButtons.swimDown = false\n        swimDownBtn.style.background = 'rgba(0, 17, 34, 0.6)'\n      })\n\n      swimDownBtn.addEventListener('touchcancel', event => {\n        event.preventDefault()\n        event.stopPropagation()\n        this.inputState.mobileButtons.swimDown = false\n        swimDownBtn.style.background = 'rgba(0, 17, 34, 0.6)'\n      })\n    }\n  }\n\n  setupSettingsModal() {\n    const settingsButton = document.getElementById('settingsButton')\n    const settingsModal = document.getElementById('settingsModal')\n    const closeSettings = document.getElementById('closeSettings')\n\n    if (settingsButton && settingsModal && closeSettings) {\n      // Open settings\n      const openSettings = event => {\n        if (event) {\n          event.preventDefault()\n          event.stopPropagation()\n        }\n        settingsModal.classList.remove('hidden')\n        // Prevent body scrolling when modal is open\n        document.body.style.overflow = 'hidden'\n\n        // Update sliders with current audio values\n        this.updateAudioSliders()\n      }\n\n      // Close settings\n      const closeModal = event => {\n        if (event) {\n          event.preventDefault()\n          event.stopPropagation()\n        }\n        settingsModal.classList.add('hidden')\n        // Restore body scrolling\n        document.body.style.overflow = ''\n      }\n\n      // Simple event handling - click events work on both desktop and mobile\n      settingsButton.addEventListener('click', openSettings)\n      closeSettings.addEventListener('click', closeModal)\n\n      // Close on background click - simplified and more reliable detection\n      settingsModal.addEventListener('click', event => {\n        // Check if the click target is the modal background itself (not a child element)\n        if (event.target === settingsModal) {\n          closeModal(event)\n        }\n      })\n\n      // Close on escape key\n      document.addEventListener('keydown', event => {\n        if (\n          event.key === 'Escape' &&\n          !settingsModal.classList.contains('hidden')\n        ) {\n          closeModal()\n        }\n      })\n    }\n\n    // Setup audio controls\n    this.setupAudioControls()\n  }\n\n  setupAudioControls() {\n    const masterVolumeSlider = document.getElementById('masterVolumeSlider')\n    const musicVolumeSlider = document.getElementById('musicVolumeSlider')\n    const sfxVolumeSlider = document.getElementById('sfxVolumeSlider')\n\n    const masterVolumeValue = document.getElementById('masterVolumeValue')\n    const musicVolumeValue = document.getElementById('musicVolumeValue')\n    const sfxVolumeValue = document.getElementById('sfxVolumeValue')\n\n    if (masterVolumeSlider && this.audioEngine) {\n      masterVolumeSlider.addEventListener('input', event => {\n        const volume = parseInt(event.target.value) / 100\n        this.audioEngine.setMasterVolume(volume)\n        if (masterVolumeValue) {\n          masterVolumeValue.textContent = `${event.target.value}%`\n        }\n      })\n    }\n\n    if (musicVolumeSlider && this.audioEngine) {\n      musicVolumeSlider.addEventListener('input', event => {\n        const volume = parseInt(event.target.value) / 100\n        this.audioEngine.setMusicVolume(volume)\n        if (musicVolumeValue) {\n          musicVolumeValue.textContent = `${event.target.value}%`\n        }\n      })\n    }\n\n    if (sfxVolumeSlider && this.audioEngine) {\n      sfxVolumeSlider.addEventListener('input', event => {\n        const volume = parseInt(event.target.value) / 100\n        this.audioEngine.setSfxVolume(volume)\n        if (sfxVolumeValue) {\n          sfxVolumeValue.textContent = `${event.target.value}%`\n        }\n      })\n    }\n  }\n\n  updateAudioSliders() {\n    if (!this.audioEngine) {\n      return\n    }\n\n    const state = this.audioEngine.getState()\n\n    const masterVolumeSlider = document.getElementById('masterVolumeSlider')\n    const musicVolumeSlider = document.getElementById('musicVolumeSlider')\n    const sfxVolumeSlider = document.getElementById('sfxVolumeSlider')\n\n    const masterVolumeValue = document.getElementById('masterVolumeValue')\n    const musicVolumeValue = document.getElementById('musicVolumeValue')\n    const sfxVolumeValue = document.getElementById('sfxVolumeValue')\n\n    if (masterVolumeSlider) {\n      const value = Math.round(state.masterVolume * 100)\n      masterVolumeSlider.value = value\n      if (masterVolumeValue) {\n        masterVolumeValue.textContent = `${value}%`\n      }\n    }\n\n    if (musicVolumeSlider) {\n      const value = Math.round(state.musicVolume * 100)\n      musicVolumeSlider.value = value\n      if (musicVolumeValue) {\n        musicVolumeValue.textContent = `${value}%`\n      }\n    }\n\n    if (sfxVolumeSlider) {\n      const value = Math.round(state.sfxVolume * 100)\n      sfxVolumeSlider.value = value\n      if (sfxVolumeValue) {\n        sfxVolumeValue.textContent = `${value}%`\n      }\n    }\n  }\n\n  onWindowResize() {\n    this.camera.aspect = window.innerWidth / window.innerHeight\n    this.camera.updateProjectionMatrix()\n    this.renderer.setSize(window.innerWidth, window.innerHeight)\n  }\n\n  updateCamera() {\n    // Enhanced camera follow logic optimized for deep underwater level\n    const playerPosition = this.player.getPosition()\n    const offset = new THREE.Vector3(0, 8, 12) // Closer offset to keep player clearly visible\n    const targetPosition = playerPosition.clone().add(offset)\n\n    this.camera.position.lerp(targetPosition, 0.1)\n\n    // Look at the player directly for optimal underwater viewing\n    const lookAtTarget = playerPosition.clone()\n    this.camera.lookAt(lookAtTarget)\n  }\n\n  startGameLoop() {\n    const animate = currentTime => {\n      requestAnimationFrame(animate)\n\n      // Calculate delta time\n      const deltaTime =\n        this.lastTime > 0 ? (currentTime - this.lastTime) / 1000 : 0.016\n      this.lastTime = currentTime\n\n      this.update(deltaTime)\n      this.render()\n    }\n    animate(0)\n  }\n\n  /**\n   * Calculate Gerstner wave displacement for realistic ocean waves\n   * @param {number} x - X coordinate\n   * @param {number} z - Z coordinate\n   * @param {number} time - Current time\n   * @param {Object} wave - Wave parameters {amplitude, frequency, speed, direction, steepness}\n   * @returns {Object} - {x, y, z} displacement\n   */\n  calculateGerstnerWave(x, z, time, wave) {\n    // Normalize direction vector\n    const dirLength = Math.sqrt(wave.direction.x ** 2 + wave.direction.z ** 2)\n    const dirX = wave.direction.x / dirLength\n    const dirZ = wave.direction.z / dirLength\n\n    // Calculate wave phase\n    const phase = (dirX * x + dirZ * z) * wave.frequency + time * wave.speed\n    const sinPhase = Math.sin(phase)\n    const cosPhase = Math.cos(phase)\n\n    // Gerstner wave equations for realistic ocean movement\n    const steepnessFactor = wave.steepness / wave.frequency\n\n    return {\n      x: steepnessFactor * dirX * sinPhase * wave.amplitude,\n      y: cosPhase * wave.amplitude,\n      z: steepnessFactor * dirZ * sinPhase * wave.amplitude,\n    }\n  }\n\n  update(deltaTime) {\n    if (!this.isLoaded) {\n      return\n    }\n\n    // Clamp delta time to prevent large jumps\n    deltaTime = Math.min(deltaTime, 0.033) // Max 30fps equivalent\n\n    // Update physics engine\n    this.physicsEngine.update(deltaTime)\n\n    // Update player with input and check for movement sounds\n    const previousPosition = this.player.getPosition().clone()\n    this.player.handleInput(this.inputState)\n    this.player.update()\n\n    // Play swimming sounds when player is moving\n    if (this.audioEngine && this.audioEngine.isInitialized) {\n      const currentPosition = this.player.getPosition()\n      const movementDistance = previousPosition.distanceTo(currentPosition)\n\n      // Play swimming sound if moving fast enough\n      if (movementDistance > 0.01) {\n        // Only play swimming sound occasionally to avoid spam\n        if (Math.random() < 0.05) {\n          // 5% chance per frame when moving\n          this.audioEngine.playSound('swimming', currentPosition)\n        }\n      }\n    }\n\n    // Update particle system\n    this.particleSystem.update(deltaTime)\n\n    // Update gate animations\n    if (this.gate) {\n      this.gate.update(deltaTime)\n    }\n\n    // Update audio system\n    if (this.audioEngine && this.audioEngine.isInitialized) {\n      const playerPos = this.player.getPosition()\n      const forward = this.camera.getWorldDirection(new THREE.Vector3())\n      const up = this.camera.up\n      this.audioEngine.updateListenerPosition(playerPos, forward, up)\n    }\n\n    // Update camera\n    this.updateCamera()\n\n    // Update underwater atmosphere effects based on camera position\n    this.updateUnderwaterAtmosphere()\n\n    // Update UI (including depth meter)\n    this.updateUI()\n\n    // Animate stars with enhanced floating and rotation effects\n    this.stars.forEach(starData => {\n      const star = starData.mesh\n      const userData = star.userData\n\n      // Enhanced rotation animation using the custom rotation axis\n      if (userData.rotationAxis) {\n        star.rotateOnAxis(userData.rotationAxis, userData.rotationSpeed)\n      } else {\n        // Fallback rotation\n        star.rotation.y += userData.rotationSpeed\n        star.rotation.x += userData.rotationSpeed * 0.5\n      }\n\n      // Floating animation\n      const time = Date.now() * 0.001\n      const floatY =\n        userData.originalY +\n        Math.sin(time * userData.floatSpeed + userData.floatOffset) * 0.3\n      star.position.y = floatY\n\n      // Enhanced pulsing emissive effect with more dramatic variation\n      const pulseFactor = 0.5 + Math.sin(time * 2 + userData.floatOffset) * 0.3\n      star.material.emissiveIntensity = pulseFactor\n    })\n\n    // Get current time for all animations\n    const time = Date.now() * 0.001\n\n    // FINAL GUARANTEED VISIBLE WAVE SYSTEM\n    if (this.waterSurface && this.waterOriginalPositions && this.waveParams) {\n      const positions = this.waterSurface.geometry.attributes.position.array\n      const time = Date.now() * 0.001\n\n      console.log(\n        `ðŸŒŠ FINAL WAVE SYSTEM - time: ${time.toFixed(2)}s, amplitude: ${this.waveParams.amplitude}`\n      )\n\n      // Apply GUARANTEED VISIBLE waves\n      for (let i = 0; i < positions.length; i += 3) {\n        const x = this.waterOriginalPositions[i]\n        const z = this.waterOriginalPositions[i + 2]\n\n        // EXTREME wave that MUST be visible\n        const waveHeight =\n          Math.sin(\n            x * this.waveParams.frequency + time * this.waveParams.speed\n          ) * this.waveParams.amplitude\n\n        positions[i] = x\n        positions[i + 1] = waveHeight // Y coordinate gets EXTREME wave height\n        positions[i + 2] = z\n      }\n      this.waterSurface.geometry.attributes.position.needsUpdate = true\n\n      // Animate wireframe at much higher position for absolute visibility\n      if (this.wireframeWater && this.wireframeOriginalPositions) {\n        const wirePositions =\n          this.wireframeWater.geometry.attributes.position.array\n        for (let i = 0; i < wirePositions.length; i += 3) {\n          const x = this.wireframeOriginalPositions[i]\n          const z = this.wireframeOriginalPositions[i + 2]\n\n          // Same wave but at higher position\n          const waveHeight =\n            Math.sin(\n              x * this.waveParams.frequency + time * this.waveParams.speed\n            ) * this.waveParams.amplitude\n\n          wirePositions[i] = x\n          wirePositions[i + 1] = waveHeight // Wireframe at same wave height\n          wirePositions[i + 2] = z\n        }\n        this.wireframeWater.geometry.attributes.position.needsUpdate = true\n      }\n\n      // Animate surface wireframe to match the water surface exactly\n      if (\n        this.surfaceWireframeWater &&\n        this.surfaceWireframeOriginalPositions\n      ) {\n        const surfaceWirePositions =\n          this.surfaceWireframeWater.geometry.attributes.position.array\n        for (let i = 0; i < surfaceWirePositions.length; i += 3) {\n          const x = this.surfaceWireframeOriginalPositions[i]\n          const z = this.surfaceWireframeOriginalPositions[i + 2]\n\n          // Same wave as the actual water surface\n          const waveHeight =\n            Math.sin(\n              x * this.waveParams.frequency + time * this.waveParams.speed\n            ) * this.waveParams.amplitude\n\n          surfaceWirePositions[i] = x\n          surfaceWirePositions[i + 1] = waveHeight // Exact same as water surface\n          surfaceWirePositions[i + 2] = z\n        }\n        this.surfaceWireframeWater.geometry.attributes.position.needsUpdate = true\n      }\n    }\n\n    // Animate foam surface to show wave crests (simplified)\n    if (this.foamSurface && this.foamOriginalPositions) {\n      const foamPositions = this.foamSurface.geometry.attributes.position.array\n\n      // Apply simple foam effects\n      for (let i = 0; i < foamPositions.length; i += 3) {\n        const x = this.foamOriginalPositions[i]\n        const z = this.foamOriginalPositions[i + 2]\n\n        // Calculate simple wave height for foam - use same wave as water surface\n        const waveHeight =\n          Math.sin(\n            x * this.waveParams.frequency + time * this.waveParams.speed\n          ) *\n            this.waveParams.amplitude +\n          Math.sin(\n            z * this.waveParams.frequency * 0.8 +\n              time * this.waveParams.speed * 1.2\n          ) *\n            this.waveParams.amplitude *\n            0.5\n\n        // Show foam on wave crests with better threshold\n        const foamThreshold = this.waveParams.amplitude * 0.3 // 30% of wave amplitude\n        if (waveHeight > foamThreshold) {\n          foamPositions[i + 1] = waveHeight + 0.5 // Higher above water for visibility\n        } else {\n          foamPositions[i + 1] = -20 // Hide foam far below surface\n        }\n      }\n\n      this.foamSurface.geometry.attributes.position.needsUpdate = true\n    }\n\n    // Animate clouds drifting across the sky\n    if (this.clouds) {\n      this.clouds.forEach(cloud => {\n        const userData = cloud.userData\n        const animationTime = time * userData.speed + userData.offset\n\n        // Gentle drift movement\n        cloud.position.x =\n          userData.originalPosition.x + Math.sin(animationTime) * 5\n        cloud.position.z =\n          userData.originalPosition.z + Math.cos(animationTime * 0.7) * 3\n\n        // Subtle opacity variation\n        cloud.material.opacity = 0.6 + Math.sin(animationTime * 2) * 0.1\n      })\n    }\n\n    // Animate celestial body (sun/moon) movement across sky\n    if (this.celestialBody && this.celestialBody.userData) {\n      const userData = this.celestialBody.userData\n      const animationTime = time * userData.animationSpeed\n\n      // Create arc movement across the sky\n      const angleOffset = userData.isEvenLevel ? 0 : Math.PI // Moon starts on opposite side\n      const angle = animationTime + angleOffset\n\n      const x =\n        Math.cos(angle) * userData.animationRadius + userData.originalPosition.x\n      const y = Math.abs(Math.sin(angle)) * 15 + 25 // Keep above horizon\n      const z = userData.originalPosition.z\n\n      this.celestialBody.position.set(x, y, z)\n\n      // Update celestial light position\n      if (this.celestialLight) {\n        this.celestialLight.position.copy(this.celestialBody.position)\n      }\n    }\n\n    // Animate volumetric lights for underwater caustics effect\n    if (this.volumetricLights) {\n      this.volumetricLights.forEach(light => {\n        const userData = light.userData\n        const animationTime =\n          time * userData.animationSpeed + userData.animationOffset\n\n        // Create gentle swaying motion\n        const offsetX = Math.sin(animationTime) * userData.animationRadius\n        const offsetZ = Math.cos(animationTime * 1.3) * userData.animationRadius\n        const offsetY = Math.sin(animationTime * 0.7) * 1\n\n        light.position.x = userData.originalPosition.x + offsetX\n        light.position.y = userData.originalPosition.y + offsetY\n        light.position.z = userData.originalPosition.z + offsetZ\n\n        // Subtle intensity variation for flickering water caustics\n        const intensityVariation = 0.8 + Math.sin(animationTime * 3) * 0.2\n        light.intensity = (this.isMobile ? 0.6 : 0.8) * intensityVariation\n      })\n    }\n\n    // Check star collection using collision detection\n    this.checkStarCollection()\n\n    // Check gate collision\n    this.checkGateCollision()\n  }\n\n  checkStarCollection() {\n    // Get player collisions from physics engine\n    const playerCollisions = this.physicsEngine.collisionSystem.checkCollisions(\n      this.player.physicsBody\n    )\n\n    for (const collision of playerCollisions) {\n      if (collision.type === 'collectible' && !collision.collected) {\n        // Collect star\n        collision.collected = true\n\n        // Find and remove the star from scene and physics\n        const starData = this.stars.find(s => s.physicsBody === collision)\n        if (starData) {\n          // Remove from scene\n          this.scene.remove(starData.mesh)\n\n          // Remove from physics\n          this.physicsEngine.removeRigidBody(starData.physicsBody)\n\n          // Remove from stars array\n          const index = this.stars.indexOf(starData)\n          if (index !== -1) {\n            this.stars.splice(index, 1)\n          }\n\n          // Update game state\n          this.starCount++\n          this.updateUI()\n\n          // Play collection sound\n          if (this.audioEngine) {\n            this.audioEngine.playSound('starCollect', starData.mesh.position)\n          }\n\n          // Create collection effect\n          this.particleSystem.createBurst(starData.mesh.position, {\n            count: 15,\n            life: 1.5,\n            velocity: new THREE.Vector3(0, 2, 0),\n            velocityVariation: new THREE.Vector3(3, 3, 3),\n            color: new THREE.Color(0xffd700),\n            size: { min: 3, max: 8 },\n          })\n\n          console.log(`â­ Star collected! Total: ${this.starCount}`)\n\n          // Check if all stars collected - activate gate\n          if (this.stars.length === 0) {\n            this.activateGate()\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * Activate the gate when all stars are collected\n   */\n  activateGate() {\n    if (this.gate && !this.gate.getIsActivated()) {\n      this.gate.activate()\n\n      // Play gate activation sound\n      if (this.audioEngine) {\n        this.audioEngine.playSound('gateActivate', this.gate.getPosition())\n      }\n\n      console.log('ðŸšª Gate activated! Swim through to complete level!')\n    }\n  }\n\n  /**\n   * Check for gate collision and level completion\n   */\n  checkGateCollision() {\n    if (!this.gate || !this.gate.getIsActivated()) {\n      return\n    }\n\n    // Get player collisions from physics engine\n    const playerCollisions = this.physicsEngine.collisionSystem.checkCollisions(\n      this.player.physicsBody\n    )\n\n    for (const collision of playerCollisions) {\n      if (collision.type === 'gate' && collision.gate) {\n        console.log('ðŸŽ¯ Gate collision detected!')\n        const levelCompleted = collision.gate.onPlayerEnter()\n        if (levelCompleted) {\n          console.log('ðŸŽ‰ Level completed via gate collision!')\n          this.levelComplete()\n          break\n        }\n      }\n    }\n  }\n\n  levelComplete() {\n    console.log('ðŸŽ‰ Level Complete!')\n\n    // Add portal transition animation\n    this.startPortalTransition()\n\n    // Play level completion sound\n    if (this.audioEngine) {\n      this.audioEngine.playSound('levelComplete')\n    }\n\n    this.levelNumber++\n\n    // Reset gate for next level\n    if (this.gate) {\n      this.gate.reset()\n    }\n\n    // Reset level with new stars\n    this.createSampleStars()\n    this.updateUI()\n  }\n\n  /**\n   * Start portal transition animation when passing through gate\n   */\n  startPortalTransition() {\n    console.log('ðŸŒŠ Starting portal transition...')\n\n    // Create transition effect particles\n    if (this.particleSystem && this.gate) {\n      const gatePosition = this.gate.getPosition()\n\n      // Create swirling portal particles\n      this.particleSystem.createBurst(gatePosition, {\n        count: 50,\n        life: 2.25, // Average of lifetime range (1.5-3)\n        velocity: new THREE.Vector3(0, 1, 0), // Base upward velocity\n        velocityVariation: new THREE.Vector3(6, 4, 6), // Variation for swirling effect\n        size: { min: 4, max: 12 },\n        color: new THREE.Color(0x87ceeb), // Light blue\n      })\n\n      // Create golden sparkles for completion\n      this.particleSystem.createBurst(gatePosition, {\n        count: 30,\n        life: 3.0, // Average of lifetime range (2-4)\n        velocity: new THREE.Vector3(0, 0.5, 0), // Slower upward velocity\n        velocityVariation: new THREE.Vector3(4, 3, 4), // Sparkle spread effect\n        size: { min: 2, max: 6 },\n        color: new THREE.Color(0xffd700), // Gold\n      })\n    }\n\n    // Camera shake effect for impact\n    if (this.camera) {\n      this.startCameraShake(0.3, 1.0) // intensity, duration\n    }\n\n    // Temporary screen flash effect\n    this.createScreenFlash()\n  }\n\n  /**\n   * Create a brief screen flash effect for portal transition\n   */\n  createScreenFlash() {\n    const flash = document.createElement('div')\n    flash.style.cssText = `\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background: radial-gradient(circle, rgba(135, 206, 235, 0.3) 0%, transparent 70%);\n      pointer-events: none;\n      z-index: 1000;\n      animation: portalFlash 1.2s ease-out forwards;\n    `\n\n    // Add CSS animation for flash effect\n    if (!document.querySelector('#portalFlashStyle')) {\n      const style = document.createElement('style')\n      style.id = 'portalFlashStyle'\n      style.textContent = `\n        @keyframes portalFlash {\n          0% { opacity: 0; }\n          20% { opacity: 1; }\n          100% { opacity: 0; }\n        }\n      `\n      document.head.appendChild(style)\n    }\n\n    document.body.appendChild(flash)\n\n    // Remove flash element after animation\n    setTimeout(() => {\n      if (flash.parentNode) {\n        flash.parentNode.removeChild(flash)\n      }\n    }, 1200)\n  }\n\n  /**\n   * Start camera shake effect\n   */\n  startCameraShake(intensity = 0.2, duration = 0.5) {\n    if (!this.camera) {\n      return\n    }\n\n    const originalPosition = this.camera.position.clone()\n    const startTime = Date.now()\n\n    const shakeAnimation = () => {\n      const elapsed = (Date.now() - startTime) / 1000\n      const progress = elapsed / duration\n\n      if (progress < 1) {\n        // Decreasing intensity over time\n        const currentIntensity = intensity * (1 - progress)\n\n        // Random shake offset\n        const shakeX = (Math.random() - 0.5) * currentIntensity * 2\n        const shakeY = (Math.random() - 0.5) * currentIntensity * 2\n        const shakeZ = (Math.random() - 0.5) * currentIntensity * 2\n\n        this.camera.position.copy(originalPosition)\n        this.camera.position.add(new THREE.Vector3(shakeX, shakeY, shakeZ))\n\n        requestAnimationFrame(shakeAnimation)\n      } else {\n        // Reset to original position\n        this.camera.position.copy(originalPosition)\n      }\n    }\n\n    shakeAnimation()\n  }\n\n  updateUI() {\n    document.getElementById('starCount').textContent = this.starCount\n    document.getElementById('levelNumber').textContent = this.levelNumber\n\n    // Update depth meter based on player Y position\n    if (this.player) {\n      const playerPosition = this.player.getPosition()\n      // Water surface is at Y=5, so depth = surface level - current Y position\n      const waterSurface = 5.0\n      const depth = Math.max(0, waterSurface - playerPosition.y)\n      document.getElementById('depthMeter').textContent = depth.toFixed(1)\n    }\n  }\n\n  render() {\n    try {\n      if (this.renderer && this.scene && this.camera) {\n        this.renderer.render(this.scene, this.camera)\n      }\n    } catch (error) {\n      // Silently handle WebGL render errors to prevent spam\n      if (this.webglErrorCount < 5) {\n        console.warn('WebGL render error:', error)\n        this.webglErrorCount = (this.webglErrorCount || 0) + 1\n      }\n    }\n  }\n\n  hideLoading() {\n    const loadingElement = document.getElementById(CONFIG.loadingId)\n    if (loadingElement) {\n      loadingElement.classList.add('hidden')\n    }\n  }\n\n  showUI() {\n    const uiElement = document.getElementById(CONFIG.uiId)\n    if (uiElement) {\n      uiElement.classList.remove('hidden')\n    }\n    this.updateUI()\n  }\n\n  showError(message) {\n    const loadingElement = document.getElementById(CONFIG.loadingId)\n    if (loadingElement) {\n      loadingElement.innerHTML = `\n        <div style=\"color: #ff4444; text-align: center;\">\n          <h3>âš ï¸ Error Loading Game</h3>\n          <p>${message}</p>\n          <p style=\"margin-top: 20px; font-size: 14px; color: #ccc;\">\n            Please check the browser console for more details and try refreshing the page.\n          </p>\n        </div>\n      `\n      loadingElement.classList.remove('hidden')\n    }\n  }\n\n  detectMobile() {\n    return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(\n      navigator.userAgent\n    )\n  }\n}\n\n// Initialize the game when the page loads\nwindow.addEventListener(\n  'DOMContentLoaded',\n  async () => {\n    try {\n      console.log('ðŸŒŠ Ocean Adventure - Starting initialization...')\n      const game = new OceanAdventure()\n      await game.initialize()\n    } catch (error) {\n      console.error('âŒ Critical error during game initialization:', error)\n      // Show error in loading div if game initialization fails\n      const loadingElement = document.getElementById('loading')\n      if (loadingElement) {\n        loadingElement.innerHTML = `\n          <div style=\"color: #ff4444; text-align: center;\">\n            <h3>âš ï¸ Critical Error</h3>\n            <p>Failed to initialize Ocean Adventure: ${error.message}</p>\n            <p style=\"margin-top: 20px; font-size: 14px; color: #ccc;\">\n              Please check the browser console for more details and try refreshing the page.\n            </p>\n          </div>\n        `\n      }\n    }\n  },\n  { passive: true }\n)\n\n// Handle WebGL context loss\nwindow.addEventListener(\n  'webglcontextlost',\n  event => {\n    event.preventDefault()\n    console.warn('WebGL context lost')\n  },\n  { passive: false }\n)\n\nwindow.addEventListener(\n  'webglcontextrestored',\n  () => {\n    console.log('WebGL context restored')\n    // Reinitialize game here if needed\n  },\n  { passive: true }\n)\n\n// Performance optimization: Pause game when page is hidden\ndocument.addEventListener(\n  'visibilitychange',\n  () => {\n    if (document.hidden) {\n      // Page is hidden, reduce performance\n      console.log('Game paused due to page visibility')\n    } else {\n      // Page is visible, resume normal performance\n      console.log('Game resumed')\n    }\n  },\n  { passive: true }\n)\n"],"names":["CollisionSystem","collider","isStatic","index","objectA","objectB","sphereA","sphereB","distance","radiusSum","boxA","boxB","minA","maxA","minB","maxB","sphere","box","boxMin","boxMax","closestPoint","THREE.Vector3","object","collisions","UnderwaterPhysics","body","deltaTime","buoyancy","currentStrength","currentForce","PhysicsEngine","previousPosition","gravityForce","velocityDelta","collision","collisionPairs","i","bodyA","bodyB","position","radius","size","Particle","velocity","life","color","ParticleSystem","scene","maxParticles","particle","THREE.Color","THREE.BufferGeometry","THREE.BufferAttribute","THREE.ShaderMaterial","THREE.AdditiveBlending","THREE.Points","canvas","context","gradient","texture","THREE.Texture","emitterConfig","emitter","p","config","count","velocityVariation","burstVelocity","particleSize","emissionInterval","activeCount","index3","type","active","e","AudioEngine","error","soundName","currentTime","oscillator","gainNode","lfo","lfoGain","envelope","attackTime","decayTime","sustainLevel","releaseTime","harmonicOscillators","harmonic","harmonicOsc","harmonicGain","panner","noteDuration","frequency","startTime","note","layer","forward","up","volume","savedSettings","settings","_a","_b","_c","Player","physicsEngine","geometry","THREE.CapsuleGeometry","material","THREE.MeshPhongMaterial","THREE.Mesh","inputState","force","targetRotation","THREE.MathUtils","time","floatingOffset","collectible","obstacle","direction","Gate","gateGeometry","THREE.TorusGeometry","gateMaterial","portalGeometry","THREE.PlaneGeometry","portalMaterial","THREE.MeshBasicMaterial","THREE.DoubleSide","THREE.PointLight","numRimLights","angle","rimLight","lightRadius","ringRadius","segments","x","y","segmentPosition","segmentBody","centerBody","light","visible","pulseIntensity","userData","animationTime","pulseFactor","wobble","StarGeometry","innerRadius","outerRadius","points","depth","starShape","THREE.Shape","halfAngleStep","extrudeSettings","starGeometry","THREE.ExtrudeGeometry","emissiveIntensity","variants","CONFIG","OceanAdventure","steps","step","stepError","THREE.WebGLRenderer","THREE.BasicShadowMap","THREE.PCFSoftShadowMap","THREE.SRGBColorSpace","THREE.ACESFilmicToneMapping","gl","THREE.Scene","THREE.PerspectiveCamera","ambientLight","THREE.AmbientLight","directionalLight","THREE.DirectionalLight","shadowMapSize","skyGeometry","THREE.SphereGeometry","skyMaterial","THREE.BackSide","skyMesh","cloudGeometry","cloudMaterial","cloud","scale","lightColors","lightCount","pointLight","isEvenLevel","sunGeometry","sunMaterial","moonGeometry","moonMaterial","cameraY","waterSurfaceLevel","wasUnderwater","THREE.Fog","child","fogIntensity","deepBlue","waterSurfaceGeometry","waterSurfaceMaterial","waterSurface","wireframeMaterial","wireframeWater","surfaceWireframeMaterial","surfaceWireframeWater","positions","wirePositions","surfaceWirePositions","foamGeometry","foamMaterial","foamSurface","floorGeometry","floorMaterial","floor","floorPhysicsBody","hue","coral","coralPhysicsBody","levelSize","wallHeight","wallThickness","wallPhysicsBody","gatePosition","starVariants","variant","starMaterial","star","starPhysicsBody","event","touch","deltaX","deltaY","moveSpeed","sensitivity","joystick","knob","joystickState","rect","maxDistance","normalizedX","normalizedY","swimUpBtn","swimDownBtn","settingsButton","settingsModal","closeSettings","openSettings","closeModal","masterVolumeSlider","musicVolumeSlider","sfxVolumeSlider","masterVolumeValue","musicVolumeValue","sfxVolumeValue","state","value","playerPosition","offset","targetPosition","lookAtTarget","animate","z","wave","dirLength","dirX","dirZ","phase","sinPhase","cosPhase","steepnessFactor","currentPosition","playerPos","starData","floatY","waveHeight","foamPositions","foamThreshold","angleOffset","offsetX","offsetZ","offsetY","intensityVariation","playerCollisions","flash","style","intensity","duration","originalPosition","shakeAnimation","progress","currentIntensity","shakeX","shakeY","shakeZ","loadingElement","uiElement","message"],"mappings":"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"}