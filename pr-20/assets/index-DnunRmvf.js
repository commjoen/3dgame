import{V as a,C as u,B as x,a as y,S as b,A as M,P as C,T as B,b as k,M as m,c as f,d as P,W as E,e as z,f as L,g as D,h as A,D as V,i as I,j as w}from"./three-Cn3NlRhr.js";function F(){import.meta.url,import("_").catch(()=>1),(async function*(){})().next()}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function e(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=e(s);fetch(s.href,o)}})();class U{constructor(){this.colliders=[],this.staticColliders=[]}addCollider(t,e=!1){(e?this.staticColliders:this.colliders).push(t)}removeCollider(t){let e=this.colliders.indexOf(t);if(e!==-1){this.colliders.splice(e,1);return}e=this.staticColliders.indexOf(t),e!==-1&&this.staticColliders.splice(e,1)}checkCollision(t,e){return t.collisionType==="sphere"&&e.collisionType==="sphere"?this.checkSphereCollision(t,e):t.collisionType==="box"&&e.collisionType==="box"?this.checkAABBCollision(t,e):t.collisionType==="sphere"&&e.collisionType==="box"||t.collisionType==="box"&&e.collisionType==="sphere"?this.checkSphereAABBCollision(t,e):!1}checkSphereCollision(t,e){const i=t.position.distanceTo(e.position),s=t.radius+e.radius;return i<=s}checkAABBCollision(t,e){const i=t.position.clone().sub(t.size.clone().multiplyScalar(.5)),s=t.position.clone().add(t.size.clone().multiplyScalar(.5)),o=e.position.clone().sub(e.size.clone().multiplyScalar(.5)),n=e.position.clone().add(e.size.clone().multiplyScalar(.5));return i.x<=n.x&&s.x>=o.x&&i.y<=n.y&&s.y>=o.y&&i.z<=n.z&&s.z>=o.z}checkSphereAABBCollision(t,e){const i=t.collisionType==="sphere"?t:e,s=t.collisionType==="box"?t:e,o=s.position.clone().sub(s.size.clone().multiplyScalar(.5)),n=s.position.clone().add(s.size.clone().multiplyScalar(.5)),r=new a(Math.max(o.x,Math.min(i.position.x,n.x)),Math.max(o.y,Math.min(i.position.y,n.y)),Math.max(o.z,Math.min(i.position.z,n.z)));return i.position.distanceTo(r)<=i.radius}checkCollisions(t){const e=[];for(const i of this.colliders)i!==t&&this.checkCollision(t,i)&&e.push(i);for(const i of this.staticColliders)this.checkCollision(t,i)&&e.push(i);return e}}class R{constructor(){this.buoyancyForce=9.8,this.dragCoefficient=.95,this.currentDirection=new a(.1,0,.05),this.currentStrength=.02}applyBuoyancy(t,e){const i=new a(0,this.buoyancyForce*e,0);t.velocity.add(i)}applyDrag(t){t.velocity.multiplyScalar(this.dragCoefficient)}applyCurrent(t,e=1,i){const s=this.currentDirection.clone().multiplyScalar(this.currentStrength*e*i);t.velocity.add(s)}applyUnderwaterEffects(t,e){this.applyBuoyancy(t,e),this.applyDrag(t),this.applyCurrent(t,1,e)}}class X{constructor(){this.gravity=new a(0,-9.8,0),this.waterDensity=1e3,this.collisionSystem=new U,this.underwaterPhysics=new R,this.rigidBodies=[],this.isUnderwater=!0}addRigidBody(t){this.rigidBodies.push(t),t.collisionType&&this.collisionSystem.addCollider(t,t.isStatic)}removeRigidBody(t){const e=this.rigidBodies.indexOf(t);e!==-1&&(this.rigidBodies.splice(e,1),this.collisionSystem.removeCollider(t))}update(t){for(const e of this.rigidBodies)this.updateBody(e,t)}updateBody(t,e){if(t.isStatic)return;t.velocity||(t.velocity=new a);const i=t.position.clone();if(this.isUnderwater)this.underwaterPhysics.applyUnderwaterEffects(t,e);else{const n=this.gravity.clone().multiplyScalar(e);t.velocity.add(n)}const s=t.velocity.clone().multiplyScalar(e);t.position.add(s);const o=this.collisionSystem.checkCollisions(t);o.length>0&&this.resolveCollisions(t,o,i)}resolveCollisions(t,e,i){t.position.copy(i),t.velocity.multiplyScalar(.3),t.onCollision&&t.onCollision(e)}checkCollisions(){const t=[];for(let e=0;e<this.rigidBodies.length;e++){const i=this.rigidBodies[e],s=this.collisionSystem.checkCollisions(i);for(const o of s)t.push([i,o])}return t}createSphereBody(t,e,i=!1){return{position:t.clone(),velocity:new a,collisionType:"sphere",radius:e,isStatic:i}}createBoxBody(t,e,i=!1){return{position:t.clone(),velocity:new a,collisionType:"box",size:e.clone(),isStatic:i}}}class Y{constructor(t,e,i,s,o){this.position=t.clone(),this.velocity=e.clone(),this.life=i,this.maxLife=i,this.size=s,this.color=o.clone(),this.alpha=1,this.active=!0}update(t){this.active&&(this.position.add(this.velocity.clone().multiplyScalar(t)),this.life-=t,this.alpha=this.life/this.maxLife,this.life<=0&&(this.active=!1))}reset(t,e,i,s,o){this.position.copy(t),this.velocity.copy(e),this.life=i,this.maxLife=i,this.size=s,this.color.copy(o),this.alpha=1,this.active=!0}}class T{constructor(t,e=1e3){this.scene=t,this.maxParticles=e,this.particles=[],this.emitters=[],this.initializeParticlePool(),this.createParticleRenderSystem(),this.createUnderwaterEmitters()}initializeParticlePool(){for(let t=0;t<this.maxParticles;t++){const e=new Y(new a,new a,1,1,new u(16777215));e.active=!1,this.particles.push(e)}}createParticleRenderSystem(){this.geometry=new x,this.positions=new Float32Array(this.maxParticles*3),this.colors=new Float32Array(this.maxParticles*3),this.sizes=new Float32Array(this.maxParticles),this.alphas=new Float32Array(this.maxParticles),this.geometry.setAttribute("position",new y(this.positions,3)),this.geometry.setAttribute("color",new y(this.colors,3)),this.geometry.setAttribute("size",new y(this.sizes,1)),this.geometry.setAttribute("alpha",new y(this.alphas,1)),this.material=new b({uniforms:{time:{value:0},pointTexture:{value:this.createParticleTexture()}},vertexShader:"\n        attribute float size;\n        attribute float alpha;\n        varying float vAlpha;\n        varying vec3 vColor;\n        \n        void main() {\n          vAlpha = alpha;\n          vColor = color;\n          \n          vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n          gl_PointSize = size * (300.0 / -mvPosition.z);\n          gl_Position = projectionMatrix * mvPosition;\n        }\n      ",fragmentShader:"\n        uniform sampler2D pointTexture;\n        varying float vAlpha;\n        varying vec3 vColor;\n        \n        void main() {\n          vec4 texColor = texture2D(pointTexture, gl_PointCoord);\n          gl_FragColor = vec4(vColor, vAlpha * texColor.a);\n        }\n      ",transparent:!0,blending:M,depthWrite:!1}),this.points=new C(this.geometry,this.material),this.scene.add(this.points)}createParticleTexture(){const t=document.createElement("canvas");t.width=64,t.height=64;const e=t.getContext("2d"),i=e.createRadialGradient(32,32,0,32,32,32);i.addColorStop(0,"rgba(255,255,255,1)"),i.addColorStop(.2,"rgba(255,255,255,0.8)"),i.addColorStop(.4,"rgba(255,255,255,0.4)"),i.addColorStop(1,"rgba(255,255,255,0)"),e.fillStyle=i,e.fillRect(0,0,64,64);const s=new B(t);return s.needsUpdate=!0,s}createUnderwaterEmitters(){this.addEmitter({type:"bubbles",position:new a(0,-10,0),rate:5,life:8,size:{min:2,max:6},velocity:new a(0,2,0),velocityVariation:new a(.5,.5,.5),color:new u(8900331),colorVariation:.1,area:new a(20,2,20)}),this.addEmitter({type:"debris",position:new a(0,0,0),rate:3,life:15,size:{min:1,max:3},velocity:new a(.1,.05,.1),velocityVariation:new a(.3,.2,.3),color:new u(16777215),colorVariation:.2,area:new a(40,20,40)}),this.addEmitter({type:"lightRays",position:new a(0,15,0),rate:.5,life:20,size:{min:8,max:15},velocity:new a(0,-.5,0),velocityVariation:new a(.1,.2,.1),color:new u(16766720),colorVariation:.1,area:new a(30,5,30)})}addEmitter(t){const e={...t,accumulator:0,active:!0};this.emitters.push(e)}emitParticle(t){const e=this.particles.find(r=>!r.active);if(!e)return;const i=t.position.clone().add(new a((Math.random()-.5)*t.area.x,(Math.random()-.5)*t.area.y,(Math.random()-.5)*t.area.z)),s=t.velocity.clone().add(new a((Math.random()-.5)*t.velocityVariation.x,(Math.random()-.5)*t.velocityVariation.y,(Math.random()-.5)*t.velocityVariation.z)),o=t.size.min+Math.random()*(t.size.max-t.size.min),n=t.color.clone();t.colorVariation>0&&n.offsetHSL((Math.random()-.5)*t.colorVariation,0,(Math.random()-.5)*t.colorVariation*.5),e.reset(i,s,t.life,o,n)}createBurst(t,e={}){const i=e.count||20,s=e.life||2,o=e.velocity||new a(0,1,0),n=e.velocityVariation||new a(2,2,2),r=e.color||new u(16766720),c=e.size||{min:2,max:8};for(let l=0;l<i;l++){const d=this.particles.find(S=>!S.active);if(!d)break;const p=o.clone().add(new a((Math.random()-.5)*n.x,(Math.random()-.5)*n.y,(Math.random()-.5)*n.z)),g=c.min+Math.random()*(c.max-c.min);d.reset(t.clone(),p,s,g,r)}}update(t){for(const i of this.emitters){if(!i.active)continue;i.accumulator+=t;const s=1/i.rate;for(;i.accumulator>=s;)this.emitParticle(i),i.accumulator-=s}let e=0;for(let i=0;i<this.particles.length;i++){const s=this.particles[i];if(s.active){s.update(t);const o=e*3;this.positions[o]=s.position.x,this.positions[o+1]=s.position.y,this.positions[o+2]=s.position.z,this.colors[o]=s.color.r,this.colors[o+1]=s.color.g,this.colors[o+2]=s.color.b,this.sizes[e]=s.size,this.alphas[e]=s.alpha,e++}}this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.color.needsUpdate=!0,this.geometry.attributes.size.needsUpdate=!0,this.geometry.attributes.alpha.needsUpdate=!0,this.geometry.setDrawRange(0,e),this.material.uniforms.time.value+=t}setEmitterActive(t,e){const i=this.emitters.find(s=>s.type===t);i&&(i.active=e)}clear(){for(const t of this.particles)t.active=!1}dispose(){this.scene.remove(this.points),this.geometry.dispose(),this.material.dispose(),this.material.uniforms.pointTexture.value&&this.material.uniforms.pointTexture.value.dispose()}}class O{constructor(t,e){this.scene=t,this.physicsEngine=e,this.moveSpeed=8,this.rotationSpeed=3,this.maxVelocity=5,this.movementVector=new a,this.isMoving=!1,this.createPlayerMesh(),this.createPhysicsBody(),this.physicsBody.onCollision=i=>this.handleCollisions(i)}createPlayerMesh(){const t=new k(.5,1.5,4,8),e=new m({color:65416,transparent:!0,opacity:.9});this.mesh=new f(t,e),this.mesh.castShadow=!0,this.mesh.receiveShadow=!0,this.scene.add(this.mesh)}createPhysicsBody(){this.physicsBody=this.physicsEngine.createSphereBody(this.mesh.position,.7,!1),this.physicsEngine.addRigidBody(this.physicsBody)}handleInput(t){this.movementVector.set(0,0,0),this.isMoving=!1,t.keys&&(t.keys.forward&&(this.movementVector.z-=1,this.isMoving=!0),t.keys.backward&&(this.movementVector.z+=1,this.isMoving=!0),t.keys.left&&(this.movementVector.x-=1,this.isMoving=!0),t.keys.right&&(this.movementVector.x+=1,this.isMoving=!0),t.keys.up&&(this.movementVector.y+=1,this.isMoving=!0),t.keys.down&&(this.movementVector.y-=1,this.isMoving=!0)),t.joystick&&(this.movementVector.x+=t.joystick.x,this.movementVector.z+=t.joystick.y,(Math.abs(t.joystick.x)>.1||Math.abs(t.joystick.y)>.1)&&(this.isMoving=!0)),t.mobileButtons&&(t.mobileButtons.swimUp&&(this.movementVector.y+=1,this.isMoving=!0),t.mobileButtons.swimDown&&(this.movementVector.y-=1,this.isMoving=!0)),this.movementVector.length()>1&&this.movementVector.normalize(),this.applyMovement()}applyMovement(){if(!this.isMoving){this.physicsBody.velocity.multiplyScalar(.9);return}const t=this.movementVector.clone().multiplyScalar(this.moveSpeed*.016);if(this.physicsBody.velocity.add(t),this.physicsBody.velocity.length()>this.maxVelocity&&this.physicsBody.velocity.normalize().multiplyScalar(this.maxVelocity),this.movementVector.length()>.1){const e=Math.atan2(this.movementVector.x,this.movementVector.z);this.mesh.rotation.y=P.lerp(this.mesh.rotation.y,e,this.rotationSpeed*.016)}}update(){this.mesh.position.copy(this.physicsBody.position);const t=Date.now()*.001;this.mesh.position.y+=Math.sin(t*2)*.02,this.physicsBody.position.copy(this.mesh.position)}handleCollisions(t){for(const e of t)e.type==="collectible"?this.handleCollectibleCollision(e):e.type==="obstacle"?this.handleObstacleCollision(e):e.type==="environment"&&this.handleEnvironmentCollision(e)}handleCollectibleCollision(t){console.log("Player collected item:",t)}handleObstacleCollision(t){const e=this.physicsBody.position.clone().sub(t.position).normalize();this.physicsBody.velocity.add(e.multiplyScalar(2))}handleEnvironmentCollision(){}getPosition(){return this.mesh.position.clone()}setPosition(t){this.mesh.position.copy(t),this.physicsBody.position.copy(t)}getVelocity(){return this.physicsBody.velocity.clone()}getIsMoving(){return this.isMoving||this.physicsBody.velocity.length()>.1}dispose(){this.physicsEngine.removeRigidBody(this.physicsBody),this.scene.remove(this.mesh),this.mesh.geometry.dispose(),this.mesh.material.dispose()}}const v={canvasId:"gameCanvas",loadingId:"loading",uiId:"ui"};class G{constructor(){this.scene=null,this.camera=null,this.renderer=null,this.canvas=null,this.isLoaded=!1,this.isMobile=this.detectMobile(),this.physicsEngine=null,this.particleSystem=null,this.player=null,this.environmentObjects=[],this.starCount=0,this.levelNumber=1,this.inputState={keys:{forward:!1,backward:!1,left:!1,right:!1,up:!1,down:!1},joystick:{x:0,y:0},mobileButtons:{swimUp:!1,swimDown:!1}},this.lastTime=0,console.log("🌊 Ocean Adventure - Initializing...")}async initialize(){try{this.setupCanvas(),this.setupRenderer(),this.setupScene(),this.setupCamera(),this.setupLights(),this.initializePhysics(),this.initializeParticleSystem(),this.createUnderwaterEnvironment(),this.createPlayer(),this.createSampleStars(),this.setupEventListeners(),this.hideLoading(),this.showUI(),this.startGameLoop(),this.isLoaded=!0,console.log("🎮 Ocean Adventure - Ready to play!")}catch(t){console.error("❌ Failed to initialize game:",t)}}setupCanvas(){if(this.canvas=document.getElementById(v.canvasId),!this.canvas)throw new Error("Game canvas not found")}setupRenderer(){try{this.renderer=new E({canvas:this.canvas,antialias:!this.isMobile,alpha:!1,powerPreference:this.isMobile?"low-power":"high-performance",failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,premultipliedAlpha:!1,stencil:!1}),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.setPixelRatio(Math.min(window.devicePixelRatio,2)),this.renderer.setClearColor(4386,1),this.isMobile||(this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=z);const t=this.renderer.getContext();if(!t)throw new Error("Failed to get WebGL context");t.getExtension("WEBGL_lose_context"),console.log("✅ WebGL Renderer initialized successfully")}catch(t){throw console.error("❌ Failed to setup renderer:",t),t}}setupScene(){this.scene=new L}initializePhysics(){this.physicsEngine=new X,console.log("⚡ Physics engine initialized")}initializeParticleSystem(){this.particleSystem=new T(this.scene,500),console.log("✨ Particle system initialized")}setupCamera(){this.camera=new D(75,window.innerWidth/window.innerHeight,.1,1e3),this.camera.position.set(0,5,10),this.camera.lookAt(0,0,0)}setupLights(){const t=new A(4210816,.4);this.scene.add(t);const e=new V(8900331,.8);e.position.set(0,50,0),!this.isMobile&&this.renderer.shadowMap.enabled&&(e.castShadow=!0,e.shadow.mapSize.width=1024,e.shadow.mapSize.height=1024,e.shadow.camera.near=.5,e.shadow.camera.far=500,e.shadow.camera.left=-50,e.shadow.camera.right=50,e.shadow.camera.top=50,e.shadow.camera.bottom=-50),this.scene.add(e)}createUnderwaterEnvironment(){const t=new I(100,100),e=new m({color:9127187}),i=new f(t,e);i.rotation.x=-Math.PI/2,i.position.y=-5,i.receiveShadow=!0,this.scene.add(i);const s=this.physicsEngine.createBoxBody(new a(0,-5,0),new a(100,.1,100),!0);s.type="environment",this.physicsEngine.addRigidBody(s);for(let o=0;o<10;o++){const n=.5+Math.random()*1.5,r=new w(n),c=new m({color:new u().setHSL(Math.random()*.3,.7,.5)}),l=new f(r,c),d=new a((Math.random()-.5)*80,-4+Math.random()*2,(Math.random()-.5)*80);l.position.copy(d),l.castShadow=!0,this.scene.add(l);const p=this.physicsEngine.createSphereBody(d,n*1.2,!0);p.type="environment",p.mesh=l,this.physicsEngine.addRigidBody(p),this.environmentObjects.push({mesh:l,physicsBody:p})}}createPlayer(){this.player=new O(this.scene,this.physicsEngine),console.log("🏊 Player created with physics")}createSampleStars(){this.stars=[];for(let t=0;t<5;t++){const e=new w(.3),i=new m({color:16766720,emissive:16766720,emissiveIntensity:.3}),s=new f(e,i),o=new a((Math.random()-.5)*20,Math.random()*8-2,(Math.random()-.5)*20);s.position.copy(o);const n=this.physicsEngine.createSphereBody(o,.5,!0);n.type="collectible",n.mesh=s,n.collected=!1,this.physicsEngine.addRigidBody(n),s.userData={rotationSpeed:.02+Math.random()*.02,physicsBody:n},this.stars.push({mesh:s,physicsBody:n}),this.scene.add(s)}}setupEventListeners(){window.addEventListener("resize",()=>this.onWindowResize()),window.addEventListener("keydown",t=>this.onKeyDown(t)),window.addEventListener("keyup",t=>this.onKeyUp(t)),this.isMobile&&this.setupTouchControls(),this.setupSettingsModal()}onKeyDown(t){switch(t.code){case"ArrowUp":case"KeyW":this.inputState.keys.forward=!0;break;case"ArrowDown":case"KeyS":this.inputState.keys.backward=!0;break;case"ArrowLeft":case"KeyA":this.inputState.keys.left=!0;break;case"ArrowRight":case"KeyD":this.inputState.keys.right=!0;break;case"Space":this.inputState.keys.up=!0,t.preventDefault();break;case"ShiftLeft":this.inputState.keys.down=!0;break}}onKeyUp(t){switch(t.code){case"ArrowUp":case"KeyW":this.inputState.keys.forward=!1;break;case"ArrowDown":case"KeyS":this.inputState.keys.backward=!1;break;case"ArrowLeft":case"KeyA":this.inputState.keys.left=!1;break;case"ArrowRight":case"KeyD":this.inputState.keys.right=!1;break;case"Space":this.inputState.keys.up=!1;break;case"ShiftLeft":this.inputState.keys.down=!1;break}}setupTouchControls(){this.setupVirtualJoystick(),this.setupMobileButtons(),this.touchState={startX:0,startY:0,currentX:0,currentY:0,isActive:!1},this.canvas.addEventListener("touchstart",t=>{if(t.preventDefault(),t.touches.length>0){const e=t.touches[0];this.touchState.startX=e.clientX,this.touchState.startY=e.clientY,this.touchState.currentX=e.clientX,this.touchState.currentY=e.clientY,this.touchState.isActive=!0}}),this.canvas.addEventListener("touchmove",t=>{if(t.preventDefault(),t.touches.length>0&&this.touchState.isActive){const e=t.touches[0];this.touchState.currentX=e.clientX,this.touchState.currentY=e.clientY;const i=this.touchState.currentX-this.touchState.startX,s=this.touchState.currentY-this.touchState.startY,o=.05,n=3;Math.abs(i)>20&&(this.player.position.x+=i/n*o*.01),Math.abs(s)>20&&(this.player.position.z+=s/n*o*.01),this.updateCamera()}}),this.canvas.addEventListener("touchend",t=>{t.preventDefault(),this.touchState.isActive=!1}),this.canvas.addEventListener("touchcancel",t=>{t.preventDefault(),this.touchState.isActive=!1})}setupVirtualJoystick(){const t=document.getElementById("virtualJoystick"),e=document.getElementById("joystickKnob");if(!t||!e)return;const i={isActive:!1,centerX:0,centerY:0,currentX:0,currentY:0};t.addEventListener("touchstart",s=>{if(s.preventDefault(),s.stopPropagation(),s.touches.length>0){const o=s.touches[0],n=t.getBoundingClientRect();i.isActive=!0,i.centerX=n.left+n.width/2,i.centerY=n.top+n.height/2,i.currentX=o.clientX,i.currentY=o.clientY,t.style.borderColor="rgba(255, 255, 255, 0.6)",t.style.background="rgba(0, 17, 34, 0.7)",this.updateJoystickKnob(e,i,n)}}),t.addEventListener("touchmove",s=>{if(s.preventDefault(),s.stopPropagation(),s.touches.length>0&&i.isActive){const o=s.touches[0],n=t.getBoundingClientRect();i.currentX=o.clientX,i.currentY=o.clientY;const r=i.currentX-i.centerX,c=i.currentY-i.centerY,l=Math.sqrt(r*r+c*c),d=n.width/2-20;if(l>5){const p=r/d,g=c/d;this.inputState.joystick.x=Math.max(-1,Math.min(1,p*1.2)),this.inputState.joystick.y=Math.max(-1,Math.min(1,g*1.2))}else this.inputState.joystick.x=0,this.inputState.joystick.y=0;this.updateJoystickKnob(e,i,n)}}),t.addEventListener("touchend",s=>{s.preventDefault(),s.stopPropagation(),i.isActive=!1,this.inputState.joystick.x=0,this.inputState.joystick.y=0,t.style.borderColor="rgba(255, 255, 255, 0.3)",t.style.background="rgba(0, 17, 34, 0.5)",e.style.transform="translate(-50%, -50%)"}),t.addEventListener("touchcancel",s=>{s.preventDefault(),s.stopPropagation(),i.isActive=!1,this.inputState.joystick.x=0,this.inputState.joystick.y=0,t.style.borderColor="rgba(255, 255, 255, 0.3)",t.style.background="rgba(0, 17, 34, 0.5)",e.style.transform="translate(-50%, -50%)"})}updateJoystickKnob(t,e,i){const s=e.currentX-e.centerX,o=e.currentY-e.centerY,n=Math.sqrt(s*s+o*o),r=i.width/2-20;if(n<=r)t.style.transform="translate(calc(-50% + ".concat(s,"px), calc(-50% + ").concat(o,"px))");else{const c=Math.atan2(o,s),l=Math.cos(c)*r,d=Math.sin(c)*r;t.style.transform="translate(calc(-50% + ".concat(l,"px), calc(-50% + ").concat(d,"px))")}}setupMobileButtons(){const t=document.getElementById("swimUpBtn"),e=document.getElementById("swimDownBtn");t&&(t.addEventListener("touchstart",i=>{i.preventDefault(),i.stopPropagation(),this.inputState.mobileButtons.swimUp=!0,t.style.background="rgba(255, 255, 255, 0.4)"}),t.addEventListener("touchend",i=>{i.preventDefault(),i.stopPropagation(),this.inputState.mobileButtons.swimUp=!1,t.style.background="rgba(0, 17, 34, 0.6)"}),t.addEventListener("touchcancel",i=>{i.preventDefault(),i.stopPropagation(),this.inputState.mobileButtons.swimUp=!1,t.style.background="rgba(0, 17, 34, 0.6)"})),e&&(e.addEventListener("touchstart",i=>{i.preventDefault(),i.stopPropagation(),this.inputState.mobileButtons.swimDown=!0,e.style.background="rgba(255, 255, 255, 0.4)"}),e.addEventListener("touchend",i=>{i.preventDefault(),i.stopPropagation(),this.inputState.mobileButtons.swimDown=!1,e.style.background="rgba(0, 17, 34, 0.6)"}),e.addEventListener("touchcancel",i=>{i.preventDefault(),i.stopPropagation(),this.inputState.mobileButtons.swimDown=!1,e.style.background="rgba(0, 17, 34, 0.6)"}))}setupSettingsModal(){const t=document.getElementById("settingsButton"),e=document.getElementById("settingsModal"),i=document.getElementById("closeSettings");if(t&&e&&i){const s=n=>{n&&(n.preventDefault(),n.stopPropagation()),e.classList.remove("hidden"),document.body.style.overflow="hidden"},o=n=>{n&&(n.preventDefault(),n.stopPropagation()),e.classList.add("hidden"),document.body.style.overflow=""};t.addEventListener("click",s),i.addEventListener("click",o),e.addEventListener("click",n=>{n.target===e&&o(n)}),document.addEventListener("keydown",n=>{n.key==="Escape"&&!e.classList.contains("hidden")&&o()})}}onWindowResize(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)}updateCamera(){const t=this.player.getPosition(),e=new a(0,5,10),i=t.clone().add(e);this.camera.position.lerp(i,.1),this.camera.lookAt(t)}startGameLoop(){const t=e=>{requestAnimationFrame(t);const i=this.lastTime>0?(e-this.lastTime)/1e3:.016;this.lastTime=e,this.update(i),this.render()};t(0)}update(t){this.isLoaded&&(t=Math.min(t,.033),this.physicsEngine.update(t),this.player.handleInput(this.inputState),this.player.update(),this.particleSystem.update(t),this.updateCamera(),this.updateUI(),this.stars.forEach(e=>{const i=e.mesh;i.rotation.y+=i.userData.rotationSpeed,i.rotation.x+=i.userData.rotationSpeed*.5}),this.checkStarCollection())}checkStarCollection(){const t=this.physicsEngine.collisionSystem.checkCollisions(this.player.physicsBody);for(const e of t)if(e.type==="collectible"&&!e.collected){e.collected=!0;const i=this.stars.find(s=>s.physicsBody===e);if(i){this.scene.remove(i.mesh),this.physicsEngine.removeRigidBody(i.physicsBody);const s=this.stars.indexOf(i);s!==-1&&this.stars.splice(s,1),this.starCount++,this.updateUI(),this.particleSystem.createBurst(i.mesh.position,{count:15,life:1.5,velocity:new a(0,2,0),velocityVariation:new a(3,3,3),color:new u(16766720),size:{min:3,max:8}}),console.log("⭐ Star collected! Total: ".concat(this.starCount)),this.stars.length===0&&this.levelComplete()}}}levelComplete(){console.log("🎉 Level Complete!"),this.levelNumber++,this.createSampleStars(),this.updateUI()}updateUI(){if(document.getElementById("starCount").textContent=this.starCount,document.getElementById("levelNumber").textContent=this.levelNumber,this.player){const t=this.player.getPosition(),e=Math.max(0,-t.y);document.getElementById("depthMeter").textContent=e.toFixed(1)}}render(){try{this.renderer&&this.scene&&this.camera&&this.renderer.render(this.scene,this.camera)}catch(t){this.webglErrorCount<5&&(console.warn("WebGL render error:",t),this.webglErrorCount=(this.webglErrorCount||0)+1)}}hideLoading(){const t=document.getElementById(v.loadingId);t&&t.classList.add("hidden")}showUI(){const t=document.getElementById(v.uiId);t&&t.classList.remove("hidden"),this.updateUI()}detectMobile(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}}window.addEventListener("DOMContentLoaded",async()=>{await new G().initialize()});window.addEventListener("webglcontextlost",h=>{h.preventDefault(),console.warn("WebGL context lost")});window.addEventListener("webglcontextrestored",()=>{console.log("WebGL context restored")});export{F as __vite_legacy_guard};
//# sourceMappingURL=index-DnunRmvf.js.map
